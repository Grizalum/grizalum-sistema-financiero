<!-- ============================================
     PANEL DE CONTROL - VISTA PRINCIPAL
     ============================================ -->

<div class="panel-control-contenedor">
    <!-- Botones superiores -->
    <div style="display: flex; justify-content: flex-end; gap: 12px; margin-bottom: 16px;">
        <!-- BotÃ³n Exportar -->
         <button id="btnExportarPanel"
                style="padding: 12px 24px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); 
                      color: white; border: none; border-radius: 10px; font-weight: 700; 
                      cursor: pointer; display: flex; align-items: center; gap: 8px;">
         <span>ðŸ“Š</span> Exportar a Excel
     </button>
        
        <!-- BotÃ³n Personalizar -->
        <button id="btnPersonalizarPanel"
                style="padding: 12px 24px; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); 
                      color: white; border: none; border-radius: 10px; font-weight: 700; 
                      cursor: pointer; display: flex; align-items: center; gap: 8px;">
         <span>ðŸŽ¨</span> Personalizar Dashboard
       </button>
    </div>
    
    <!-- SecciÃ³n de MÃ©tricas -->
    <section class="metricas-grid">
        <div class="metrica-tarjeta gastos">
            <div class="metrica-header">
                <span class="metrica-titulo">Gastos Operativos</span>
                <div class="metrica-icono gastos">
                    <i class="fas fa-receipt"></i>
                </div>
            </div>
            <div class="metrica-valor" id="expensesValue">S/. 0</div>
            <div class="metrica-cambio negativo">
                <i class="fas fa-arrow-up"></i>
                <span>+3.2% vs mes anterior</span>
            </div>
        </div>

        <div class="metrica-tarjeta utilidad">
            <div class="metrica-header">
                <span class="metrica-titulo">Utilidad Neta</span>
                <div class="metrica-icono utilidad">
                    <i class="fas fa-coins"></i>
                </div>
            </div>
            <div class="metrica-valor" id="profitValue">S/. 0</div>
            <div class="metrica-cambio positivo">
                <i class="fas fa-arrow-up"></i>
                <span>+18.7% vs mes anterior</span>
            </div>
        </div>

        <div class="metrica-tarjeta crecimiento">
            <div class="metrica-header">
                <span class="metrica-titulo">Crecimiento</span>
                <div class="metrica-icono crecimiento">
                    <i class="fas fa-chart-area"></i>
                </div>
            </div>
            <div class="metrica-valor" id="growthValue">+0%</div>
            <div class="metrica-cambio positivo">
                <i class="fas fa-arrow-up"></i>
                <span>Meta anual: 20%</span>
            </div>
        </div>

        <div class="metrica-tarjeta ingresos">
            <div class="metrica-header">
                <span class="metrica-titulo">Ingresos Totales</span>
                <div class="metrica-icono ingresos">
                    <i class="fas fa-arrow-trend-up"></i>
                </div>
            </div>
            <div class="metrica-valor" id="revenueValue">S/. 0</div>
            <div class="metrica-cambio positivo">
                <i class="fas fa-arrow-up"></i>
                <span>+12.5% vs mes anterior</span>
            </div>
        </div>
    </section>

    <div id="dashboardWidgetsContainer"></div>

    <!-- SecciÃ³n de GrÃ¡ficos -->
    <section class="graficos-seccion">
        <div class="grafico-tarjeta principal">
            <div class="grafico-header">
                <h3 class="grafico-titulo">Flujo de Caja - Ãšltimos 6 Meses</h3>
                <div class="grafico-filtros">
                    <button class="filtro-btn activo">6M</button>
                    <button class="filtro-btn">1A</button>
                    <button class="filtro-btn">2A</button>
                </div>
            </div>
            <div class="grafico-contenedor">
                <canvas id="mainCashFlowChart"></canvas>
            </div>
        </div>

        <div class="grafico-tarjeta">
            <div class="grafico-header">
                <h3 class="grafico-titulo">DistribuciÃ³n de Gastos</h3>
            </div>
            <div class="grafico-contenedor">
                <canvas id="expensesChart"></canvas>
            </div>
        </div>
        
        <div class="grafico-tarjeta">
            <div class="grafico-header">
                <h3 class="grafico-titulo">Ingresos vs Gastos</h3>
            </div>
            <div class="grafico-contenedor">
                <canvas id="revenueChart"></canvas>
            </div>
        </div>
        
        <div class="grafico-tarjeta">
            <div class="grafico-header">
                <h3 class="grafico-titulo">AntigÃ¼edad de Cuentas</h3>
            </div>
            <div class="grafico-contenedor">
                <canvas id="agingChart"></canvas>
            </div>
        </div>
        
        <div class="grafico-tarjeta">
            <div class="grafico-header">
                <h3 class="grafico-titulo">Flujo de Caja Diario</h3>
            </div>
            <div class="grafico-contenedor">
                <canvas id="cashFlowDetailChart"></canvas>
            </div>
        </div>
    </section>

</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- DEPENDENCIAS: FLUJO DE CAJA (necesario para leer datos) -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script src="src/vistas/flujo-caja/flujo-caja.js?v=1762841000"></script>
<script src="src/vistas/flujo-caja/flujo-caja-ui.js?v=1762841000"></script>
<script src="src/vistas/flujo-caja/flujo-caja-planes.js?v=1762841000"></script>
<script src="src/vistas/flujo-caja/flujo-caja-categorias.js?v=1762841000"></script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- SCRIPTS DEL PANEL DE CONTROL -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script src="src/vistas/panel-control/panel-control.js?v=1762841000"></script>
<script src="src/vistas/panel-control/panel-control-planes.js?v=1762841000"></script>
<script src="src/vistas/panel-control/panel-control-plan-loader.js?v=1762841000"></script>
<script src="src/vistas/panel-control/panel-control-ui.js?v=1762841000"></script>
<script src="https://cdn.jsdelivr.net/npm/exceljs@4.4.0/dist/exceljs.min.js"></script>
<script src="src/vistas/panel-control/panel-control-exportador.js?v=1762841000"></script>
<script src="src/vistas/panel-control/panel-control-fix.js?v=1762841000"></script>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIGURACIÃ“N DE BOTONES DEL PANEL DE CONTROL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

(function() {
    'use strict';
    
    console.log('ðŸ”§ Configurando botones del Panel de Control...');
    
    // Esperar a que el DOM estÃ© listo
    function configurarBotones() {
        // BotÃ³n de Exportar
        const btnExportar = document.getElementById('btnExportarPanel');
        if (btnExportar) {
            btnExportar.addEventListener('click', async function() {
                try {
                    console.log('ðŸ“Š Iniciando exportaciÃ³n...');
                    
                    // Verificar que panelControl estÃ© listo
                    if (!window.panelControl || !window.panelControl.estaListo()) {
                        alert('âš ï¸ Panel de Control aÃºn estÃ¡ cargando. Espera un momento.');
                        return;
                    }
                    
                    // Verificar ExportadorPanelControl
                    if (typeof ExportadorPanelControl === 'undefined') {
                        alert('âš ï¸ Sistema de exportaciÃ³n no estÃ¡ disponible. Recarga la pÃ¡gina.');
                        console.error('ExportadorPanelControl no estÃ¡ definido');
                        return;
                    }

                    const info = window.panelControl.obtenerInfo();
                    const flujoCaja = window.panelControl.obtenerDatosFlujoCaja(6);
                    
                    const datosExportar = {
                        empresa: info.empresaActual || 'default',
                        nivel: info.nivel?.score || 0,
                        plan: info.plan?.nombre || 'Individual',
                        datos: info.datos,
                        flujoCaja: flujoCaja,
                        categoriasIngresos: window.panelControl.obtenerDatosCategoria('ingreso'),
                        categoriasGastos: window.panelControl.obtenerDatosCategoria('gasto')
                    };

                    const exportador = new ExportadorPanelControl();
                    await exportador.exportar(datosExportar);
                    
                    alert('âœ… Excel exportado exitosamente');
                    
                } catch (error) {
                    console.error('âŒ Error exportando:', error);
                    alert('âŒ Error al exportar: ' + error.message);
                }
            });
            console.log('âœ… BotÃ³n Exportar configurado');
        } else {
            console.warn('âš ï¸ BotÃ³n exportar no encontrado');
        }

        // BotÃ³n de Personalizar
        const btnPersonalizar = document.getElementById('btnPersonalizarPanel');
        if (btnPersonalizar) {
            btnPersonalizar.addEventListener('click', function() {
                // Verificar plan
                if (!window.PanelControlPlanes) {
                    alert('âš ï¸ Sistema de planes no estÃ¡ cargado');
                    return;
                }
                
                const tieneFuncionalidad = window.PanelControlPlanes.tieneFuncionalidad('personalizarDashboard');
                
                if (!tieneFuncionalidad) {
                    alert('âš ï¸ La personalizaciÃ³n del dashboard requiere plan Empresarial o superior');
                    if (window.PanelControlPlanes.mostrarModalUpgrade) {
                        window.PanelControlPlanes.mostrarModalUpgrade('personalizarDashboard');
                    }
                    return;
                }
                
                // Si tiene la funcionalidad, activar personalizaciÃ³n
                if (window.dashboardPersonalizable && window.dashboardPersonalizable.activarModoEdicion) {
                    window.dashboardPersonalizable.activarModoEdicion();
                } else {
                    alert('ðŸŽ¨ Sistema de personalizaciÃ³n en desarrollo');
                }
            });
            console.log('âœ… BotÃ³n Personalizar configurado');
        } else {
            console.warn('âš ï¸ BotÃ³n personalizar no encontrado');
        }
        
        // Aplicar restricciones segÃºn plan
        setTimeout(() => {
            if (window.PanelControlPlanes) {
                window.PanelControlPlanes.aplicarRestricciones();
            }
        }, 1000);
    }
    
    // Ejecutar cuando el DOM estÃ© listo
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', configurarBotones);
    } else {
        setTimeout(configurarBotones, 500);
    }
    
})();

console.log('âœ… Script de botones del Panel de Control cargado');
</script>

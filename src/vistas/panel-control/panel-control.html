<!-- ============================================
     PANEL DE CONTROL - VISTA PRINCIPAL
     ============================================ -->

<div class="panel-control-contenedor">
     <!-- Agregar bot√≥n aqu√≠ arriba -->
    <div style="display: flex; justify-content: flex-end; margin-bottom: 16px;">
        <button onclick="dashboardPersonalizable.activarModoEdicion()" 
                style="padding: 12px 24px; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); 
                       color: white; border: none; border-radius: 10px; font-weight: 700; 
                       cursor: pointer; display: flex; align-items: center; gap: 8px;">
            <span>üé®</span> Personalizar Dashboard
        </button>
    </div>
    
    <!-- Secci√≥n de M√©tricas -->
    <section class="metricas-grid">
        <div class="metrica-tarjeta gastos">
            <div class="metrica-header">
                <span class="metrica-titulo">Gastos Operativos</span>
                <div class="metrica-icono gastos">
                    <i class="fas fa-receipt"></i>
                </div>
            </div>
            <div class="metrica-valor" id="expensesValue">S/. 0</div>
            <div class="metrica-cambio negativo">
                <i class="fas fa-arrow-up"></i>
                <span>+3.2% vs mes anterior</span>
            </div>
        </div>

        <div class="metrica-tarjeta utilidad">
            <div class="metrica-header">
                <span class="metrica-titulo">Utilidad Neta</span>
                <div class="metrica-icono utilidad">
                    <i class="fas fa-coins"></i>
                </div>
            </div>
            <div class="metrica-valor" id="profitValue">S/. 0</div>
            <div class="metrica-cambio positivo">
                <i class="fas fa-arrow-up"></i>
                <span>+18.7% vs mes anterior</span>
            </div>
        </div>

        <div class="metrica-tarjeta crecimiento">
            <div class="metrica-header">
                <span class="metrica-titulo">Crecimiento</span>
                <div class="metrica-icono crecimiento">
                    <i class="fas fa-chart-area"></i>
                </div>
            </div>
            <div class="metrica-valor" id="growthValue">+0%</div>
            <div class="metrica-cambio positivo">
                <i class="fas fa-arrow-up"></i>
                <span>Meta anual: 20%</span>
            </div>
        </div>

        <div class="metrica-tarjeta ingresos">
            <div class="metrica-header">
                <span class="metrica-titulo">Ingresos Totales</span>
                <div class="metrica-icono ingresos">
                    <i class="fas fa-arrow-trend-up"></i>
                </div>
            </div>
            <div class="metrica-valor" id="revenueValue">S/. 0</div>
            <div class="metrica-cambio positivo">
                <i class="fas fa-arrow-up"></i>
                <span>+12.5% vs mes anterior</span>
            </div>
        </div>
    </section>

     <div id="dashboardWidgetsContainer"></div>

    <!-- Secci√≥n de Gr√°ficos -->
    <section class="graficos-seccion">
        <div class="grafico-tarjeta principal">
            <div class="grafico-header">
                <h3 class="grafico-titulo">Flujo de Caja - √öltimos 6 Meses</h3>
                <div class="grafico-filtros">
                    <button class="filtro-btn activo">6M</button>
                    <button class="filtro-btn">1A</button>
                    <button class="filtro-btn">2A</button>
                </div>
            </div>
            <div class="grafico-contenedor">
                <canvas id="mainCashFlowChart"></canvas>
            </div>
        </div>

        <div class="grafico-tarjeta">
            <div class="grafico-header">
                <h3 class="grafico-titulo">Distribuci√≥n de Gastos</h3>
            </div>
            <div class="grafico-contenedor">
                <canvas id="expensesChart"></canvas>
            </div>
        </div>
        
        <div class="grafico-tarjeta">
            <div class="grafico-header">
                <h3 class="grafico-titulo">Ingresos vs Gastos</h3>
            </div>
            <div class="grafico-contenedor">
                <canvas id="revenueChart"></canvas>
            </div>
        </div>
        
        <div class="grafico-tarjeta">
            <div class="grafico-header">
                <h3 class="grafico-titulo">Antig√ºedad de Cuentas</h3>
            </div>
            <div class="grafico-contenedor">
                <canvas id="agingChart"></canvas>
            </div>
        </div>
        
        <div class="grafico-tarjeta">
            <div class="grafico-header">
                <h3 class="grafico-titulo">Flujo de Caja Diario</h3>
            </div>
            <div class="grafico-contenedor">
                <canvas id="cashFlowDetailChart"></canvas>
            </div>
        </div>
    </section>

     <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- SCRIPTS DEL PANEL DE CONTROL CON TIMESTAMP -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<!-- 1. M√≥dulo principal -->
<script src="src/vistas/panel-control/panel-control.js?v=1762812500"></script>

<!-- 2. Sistema de planes y restricciones -->
<script src="src/vistas/panel-control/panel-control-planes.js?v=1762812500"></script>

<!-- 3. Loader del banner -->
<script src="src/vistas/panel-control/panel-control-plan-loader.js?v=1762812500"></script>

<!-- 4. Interfaz visual -->
<script src="src/vistas/panel-control/panel-control-ui.js?v=1762812500"></script>

<!-- 5. ExcelJS (externo) -->
<script src="https://cdn.jsdelivr.net/npm/exceljs@4.4.0/dist/exceljs.min.js"></script>

<!-- 6. Exportador Excel -->
<script src="src/vistas/panel-control/panel-control-exportador.js?v=1762812500"></script>

<!-- 7. Correcciones y fixes -->
<script src="src/vistas/panel-control/panel-control-fix.js?v=1762812500"></script>

<!-- 8. Funci√≥n de exportaci√≥n -->
<script>
async function exportarPanelControl() {
    try {
        console.log('üìä Iniciando exportaci√≥n...');
        
        if (!window.panelControl || !window.panelControl.estaListo()) {
            alert('‚ö†Ô∏è Panel de Control a√∫n est√° cargando. Espera un momento.');
            return;
        }

        const info = window.panelControl.obtenerInfo();
        const flujoCaja = window.panelControl.obtenerDatosFlujoCaja(6);
        
        const datosExportar = {
            empresa: info.empresaActual || 'default',
            nivel: info.nivel?.score || 0,
            plan: info.plan?.nombre || 'Individual',
            datos: info.datos,
            flujoCaja: flujoCaja,
            categoriasIngresos: window.panelControl.obtenerDatosCategoria('ingreso'),
            categoriasGastos: window.panelControl.obtenerDatosCategoria('gasto')
        };

        const exportador = new ExportadorPanelControl();
        await exportador.exportar(datosExportar);
        
        alert('‚úÖ Excel exportado exitosamente');
        
    } catch (error) {
        console.error('‚ùå Error exportando:', error);
        alert('‚ùå Error al exportar: ' + error.message);
    }
}

window.exportarPanelControl = exportarPanelControl;
console.log('‚úÖ Funci√≥n exportarPanelControl registrada');
</script>

</div>

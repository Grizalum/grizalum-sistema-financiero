<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRIZALUM | Centro de Control Financiero</title>
    <!-- ESTILOS EXTERNOS PROFESIONALES -->
<link rel="stylesheet" href="./src/assets/css/styles.css">
<!-- Meta Tags SEO -->
<meta name="description" content="Sistema financiero empresarial premium con IA integrada para empresas peruanas. Dashboard ejecutivo, flujo de caja, anÃ¡lisis predictivo.">
<meta name="keywords" content="sistema financiero, empresas peru, contabilidad, flujo de caja, dashboard, IA">
<meta name="author" content="GRIZALUM">

<!-- Favicon -->
<link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“Š</text></svg>">

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

<!-- Chart.js -->
<script src="https://unpkg.com/chart.js"></script>
    
<!-- FontAwesome -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
   
 <!-- ADVANCED AI ASSISTANT PROFESIONAL -->
<!-- SOLO PARA PRUEBA -->
<script>
console.log('ğŸ¤– Probando IA bÃ¡sica...');
</script>
    
<!-- PWA MANIFEST -->
<link rel="manifest" href="manifest.json">

<!-- META TAGS PARA PWA -->
<meta name="application-name" content="GRIZALUM">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="GRIZALUM">
<meta name="mobile-web-app-capable" content="yes">
<meta name="msapplication-TileColor" content="#d4af37">
<meta name="theme-color" content="#d4af37">

<!-- ICONOS ADICIONALES -->
<link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“Š</text></svg>">

</head>
<body>
   <!-- PANTALLA DE CARGA -->
   <div id="loadingScreen" class="loading-screen">
       <div class="loading-content">
           <div class="brand-icon loading-logo">
               <i class="fas fa-chart-line"></i>
           </div>
           <h1>GRIZALUM</h1>
           <p>Cargando sistema financiero...</p>
           <div class="loading-bar">
               <div class="loading-progress"></div>
           </div>
       </div>
   </div>

   <div class="app-container">
       <!-- BARRA LATERAL -->
       <nav class="sidebar" id="sidebar">
           <div class="sidebar-header">
               <div class="company-brand">
                   <div class="brand-icon">
                       <i class="fas fa-chart-line"></i>
                   </div>
                   <div class="brand-text">
                       <h1>GRIZALUM</h1>
                       <p>Control Financiero</p>
                   </div>
               </div>
               
               <div class="financial-summary">
                   <div class="summary-item">
                       <span class="summary-label">Flujo de Caja</span>
                       <span class="summary-value" id="sidebarCashFlow">S/. 24,500</span>
                   </div>
                   <div class="summary-item">
                       <span class="summary-label">Utilidad Neta</span>
                       <span class="summary-value" id="sidebarProfit">S/. 16,500</span>
                   </div>
               </div>
           </div>

           <div class="nav-menu">
               <div class="nav-section">
                   <div class="nav-section-title">
                       <i class="fas fa-chart-bar"></i>
                       Panel Principal
                   </div>
                   <div class="nav-item">
                       <a href="#" class="nav-link active" onclick="showSection('dashboard')">
                           <i class="nav-icon fas fa-tachometer-alt"></i>
                           <span>Panel de Control</span>
                       </a>
                   </div>
                   <div class="nav-item">
                       <a href="#" class="nav-link" onclick="showSection('cash-flow')">
                           <i class="nav-icon fas fa-water"></i>
                           <span>Flujo de Caja</span>
                       </a>
                   </div>
               </div>

               <div class="nav-section">
                   <div class="nav-section-title">
                       <i class="fas fa-calculator"></i>
                       Contabilidad
                   </div>
                   <div class="nav-item">
                       <a href="#" class="nav-link" onclick="showSection('income-statement')">
                           <i class="nav-icon fas fa-chart-pie"></i>
                           <span>Estado de Resultados</span>
                       </a>
                   </div>
                   <div class="nav-item">
                       <a href="#" class="nav-link" onclick="showSection('balance-sheet')">
                           <i class="nav-icon fas fa-balance-scale"></i>
                           <span>Balance General</span>
                       </a>
                   </div>
               </div>

               <div class="nav-section">
                   <div class="nav-section-title">
                       <i class="fas fa-warehouse"></i>
                       Operaciones
                   </div>
                   <div class="nav-item">
                       <a href="#" class="nav-link" onclick="showSection('inventory')">
                           <i class="nav-icon fas fa-boxes"></i>
                           <span>Inventario</span>
                       </a>
                   </div>
                   <div class="nav-item">
                       <a href="#" class="nav-link" onclick="showSection('sales')">
                           <i class="nav-icon fas fa-shopping-cart"></i>
                           <span>Ventas</span>
                       </a>
                   </div>
               </div>
           </div>
       </nav>

       <!-- CONTENIDO PRINCIPAL -->
       <main class="main-content">
           <header class="executive-header">
               <button class="mobile-menu-toggle" onclick="toggleSidebar()">
                   <i class="fas fa-bars"></i>
               </button>
               
               <div class="page-header">
                   <div>
                       <h1 class="page-title" id="pageTitle">Panel de Control Ejecutivo</h1>
                       <p class="page-subtitle" id="pageSubtitle">Resumen financiero en tiempo real</p>
                       <div class="ai-insights">
                           <i class="fas fa-brain"></i>
                           <span>IA predice un crecimiento del 15% este trimestre</span>
                       </div>
                   </div>
               </div>

               <div class="header-controls">
               <div class="time-period-selector">
                  <button class="period-btn active" onclick="changePeriod('hoy', this)">Hoy</button>
                 <button class="period-btn" onclick="changePeriod('semana', this)">Semana</button>
                 <button class="period-btn" onclick="changePeriod('mes', this)">Mes</button>
                 <button class="period-btn" onclick="changePeriod('trimestre', this)">Trimestre</button>
                 <button class="period-btn" onclick="changePeriod('aÃ±o', this)">AÃ±o</button>
             </div>
    
            <button class="notification-center" onclick="showNotifications()">
                 <i class="fas fa-bell"></i>
             <span class="notification-badge">3</span>
            </button>
    
            <!-- BOTÃ“N IA EN HEADER -->
         <button class="ai-header-button" onclick="toggleAIAssistant()">
         <i class="fas fa-brain"></i>
         <span>IA Assistant</span>
        </button>
          <!-- SELECTOR DE EMPRESAS -->
          <div class="company-selector" id="companySelector">
          <!-- Se genera automÃ¡ticamente por company-selector.js -->
               </div>
                </div>
            </div>
           </header>

           <!-- DASHBOARD CONTENT -->
           <div id="dashboardContent" class="dashboard-content" style="padding-top: 0 !important; margin-top: 0 !important;">
               <!-- METRICS GRID -->
               <section class="metrics-grid">
    <!-- CARD 1: INGRESOS -->
    <div class="metric-card revenue">
        <div class="metric-header">
            <span class="metric-title">Ingresos Totales</span>
            <div class="metric-icon revenue">
                <i class="fas fa-arrow-trend-up"></i>
            </div>
        </div>
        <div class="metric-value" id="revenueValue">S/. 2,847,293</div>
        <div class="metric-change positive">
            <i class="fas fa-arrow-up"></i>
            <span>+12.5% vs mes anterior</span>
        </div>
    </div>

    <!-- CARD 2: GASTOS -->
    <div class="metric-card expenses">
        <div class="metric-header">
            <span class="metric-title">Gastos Operativos</span>
            <div class="metric-icon expenses">
                <i class="fas fa-receipt"></i>
            </div>
        </div>
        <div class="metric-value" id="expensesValue">S/. 28,700</div>
        <div class="metric-change negative">
            <i class="fas fa-arrow-down"></i>
            <span>+3.2% vs mes anterior</span>
        </div>
    </div>

    <!-- CARD 3: UTILIDAD -->
    <div class="metric-card profit">
        <div class="metric-header">
            <span class="metric-title">Utilidad Neta</span>
            <div class="metric-icon profit">
                <i class="fas fa-coins"></i>
            </div>
        </div>
        <div class="metric-value" id="profitValue">S/. 16,500</div>
        <div class="metric-change positive">
            <i class="fas fa-arrow-up"></i>
            <span>+18.7% vs mes anterior</span>
        </div>
    </div>

    <!-- CARD 4: CRECIMIENTO -->
    <div class="metric-card growth">
        <div class="metric-header">
            <span class="metric-title">Crecimiento</span>
            <div class="metric-icon growth">
                <i class="fas fa-chart-area"></i>
            </div>
        </div>
        <div class="metric-value" id="growthValue">+24.8%</div>
        <div class="metric-change positive">
            <i class="fas fa-arrow-up"></i>
            <span>Meta anual: 20%</span>
        </div>
    </div>
</section>

              <!-- CHARTS SECTION COMPLETA -->
<section class="charts-section">
    <!-- GrÃ¡fico Principal de Flujo de Caja -->
    <div class="chart-card main-chart">
        <div class="chart-header">
            <h3 class="chart-title">Flujo de Caja - Ãšltimos 6 Meses</h3>
            <div class="chart-filters">
                <button class="filter-btn active">6M</button>
                <button class="filter-btn">1A</button>
                <button class="filter-btn">2A</button>
            </div>
        </div>
        <div class="chart-container">
            <canvas id="cashFlowChart"></canvas>
        </div>
    </div>

    <!-- GrÃ¡fico de DistribuciÃ³n de Gastos -->
    <div class="chart-card">
        <div class="chart-header">
            <h3 class="chart-title">DistribuciÃ³n de Gastos</h3>
        </div>
        <div class="chart-container">
            <canvas id="expensesChart"></canvas>
        </div>
    </div>
    
    <!-- GrÃ¡fico de Ingresos vs Gastos -->
    <div class="chart-card">
        <div class="chart-header">
            <h3 class="chart-title">Ingresos vs Gastos</h3>
        </div>
        <div class="chart-container">
            <canvas id="revenueChart"></canvas>
        </div>
    </div>
    
    <!-- GrÃ¡fico de AntigÃ¼edad de Cuentas -->
    <div class="chart-card">
        <div class="chart-header">
            <h3 class="chart-title">AntigÃ¼edad de Cuentas</h3>
        </div>
        <div class="chart-container">
            <canvas id="agingChart"></canvas>
        </div>
    </div>
    
    <!-- GrÃ¡fico Detallado de Flujo de Caja -->
    <div class="chart-card">
        <div class="chart-header">
            <h3 class="chart-title">Flujo de Caja Diario</h3>
        </div>
        <div class="chart-container">
            <canvas id="cashFlowDetailChart"></canvas>
                 </div>
              </div>
          </section>
           </div>
       </main>
   </div>
<!-- MODAL GESTIÃ“N AVANZADA DE EMPRESAS -->
<div id="companyManagementModal" class="grizalum-modal">
    <div class="grizalum-modal-content">
        <div class="grizalum-modal-header">
            <div class="modal-title">
                <i class="fas fa-building"></i>
                <span>GestiÃ³n Avanzada de Empresas</span>
            </div>
            <button class="modal-close-btn" onclick="closeCompanyManagement()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="company-tabs">
            <button class="company-tab active" data-tab="edit">
                <i class="fas fa-edit"></i> InformaciÃ³n
            </button>
            <button class="company-tab" data-tab="customization">
                <i class="fas fa-palette"></i> PersonalizaciÃ³n
            </button>
            <button class="company-tab" data-tab="reports">
                <i class="fas fa-file-pdf"></i> Reportes
            </button>
            <button class="company-tab" data-tab="advanced">
                <i class="fas fa-cogs"></i> Avanzado
            </button>
        </div>
        
        <div class="company-tab-content">
            <!-- TAB INFORMACIÃ“N -->
            <div id="editTab" class="tab-panel active">
                <div class="company-edit-form">
                    <div class="form-group">
                        <label>Nombre de la Empresa</label>
                        <input type="text" id="companyNameEdit" class="grizalum-input" placeholder="Ej: FundiciÃ³n Laguna">
                    </div>
                    
                    <div class="form-group">
                        <label>Estado Operativo</label>
                        <select id="companyStatusEdit" class="grizalum-select">
                            <option value="operativo">Totalmente Operativo</option>
                            <option value="regular">Regular</option>
                            <option value="mantenimiento">En Mantenimiento</option>
                            <option value="critico">Estado CrÃ­tico</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button class="btn-cancel" onclick="closeCompanyManagement()">Cancelar</button>
                        <button class="btn-create" onclick="saveCompanyChanges()">
                            <i class="fas fa-save"></i> Guardar Cambios
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- TAB PERSONALIZACIÃ“N -->
            <div id="customizationTab" class="tab-panel">
                <h3>PersonalizaciÃ³n Visual</h3>
                <p>PrÃ³ximamente: Themes y colores personalizados</p>
            </div>
            
            <!-- TAB REPORTES -->
            <div id="reportsTab" class="tab-panel">
                <h3>Reportes y Descargas</h3>
                <p>PrÃ³ximamente: GeneraciÃ³n de PDFs profesionales</p>
            </div>
            
            <!-- TAB AVANZADO -->
            <div id="advancedTab" class="tab-panel">
                <h3>ConfiguraciÃ³n Avanzada</h3>
                <p>PrÃ³ximamente: Configuraciones empresariales</p>
            </div>
        </div>
    </div>
</div>
    
    <!-- MODAL AGREGAR NUEVA EMPRESA -->
<div id="addCompanyModal" class="grizalum-modal">
    <div class="grizalum-modal-content">
        <div class="grizalum-modal-header">
            <div class="modal-title">
                <i class="fas fa-plus-circle"></i>
                <span>Nueva Empresa</span>
            </div>
            <button class="modal-close-btn" onclick="closeAddCompanyModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="grizalum-modal-body">
            <div class="company-form">
                <div class="form-step active" id="step1">
                    <h3>InformaciÃ³n BÃ¡sica</h3>
                    
                    <div class="form-field">
                        <label>Nombre de la empresa</label>
                        <input type="text" id="newCompanyName" placeholder="Ej: Mi Nueva Empresa S.A.C." class="grizalum-input">
                    </div>
                    <div class="form-field">
    <label>Icono de la empresa</label>
    <div class="emoji-selector-container">
        <div class="selected-emoji" id="selectedEmoji">
            <span class="emoji-display">ğŸ¢</span>
            <span class="emoji-label">Seleccionar icono</span>
            <i class="fas fa-chevron-down"></i>
        </div>
        
        <!-- EMOJI PICKER Ã‰PICO -->
        <div id="emojiPicker" class="emoji-picker">
            <div class="emoji-search">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Buscar emoji..." id="emojiSearch">
            </div>
            
<div class="emoji-categories">
    <button class="emoji-cat active" data-category="business" title="Negocios">ğŸ’¼</button>
    <button class="emoji-cat" data-category="faces" title="Caritas">ğŸ˜€</button>
    <button class="emoji-cat" data-category="people" title="Personas">ğŸ‘¤</button>
    <button class="emoji-cat" data-category="industry" title="Industria">ğŸ­</button>
    <button class="emoji-cat" data-category="commerce" title="Comercio">ğŸª</button>
    <button class="emoji-cat" data-category="food" title="Comida">ğŸ•</button>
    <button class="emoji-cat" data-category="transport" title="Transporte">ğŸšš</button>
    <button class="emoji-cat" data-category="tech" title="TecnologÃ­a">ğŸ’»</button>
    <button class="emoji-cat" data-category="medical" title="Salud">ğŸ¥</button>
    <button class="emoji-cat" data-category="education" title="EducaciÃ³n">ğŸ“</button>
    <button class="emoji-cat" data-category="animals" title="Animales">ğŸ¶</button>
    <button class="emoji-cat" data-category="nature" title="Naturaleza">ğŸŒ±</button>
    <button class="emoji-cat" data-category="hands" title="Manos">ğŸ‘‹</button>
    <button class="emoji-cat" data-category="objects" title="Objetos">ğŸ“±</button>
    <button class="emoji-cat" data-category="symbols" title="SÃ­mbolos">â¤ï¸</button>
</div>
            
            <div class="emoji-grid" id="emojiGrid">
                <!-- Se llena dinÃ¡micamente -->
            </div>
            
            <div class="emoji-recents">
                <h4>ğŸ•’ Recientes</h4>
                <div class="emoji-recent-list" id="recentEmojis">
                    <!-- Emojis recientes -->
                </div>
            </div>
        </div>
    </div>
</div>
                    <div class="form-field">
                        <label>Tipo de negocio</label>
                        <select id="newCompanyType" class="grizalum-select">
                            <option value="">Selecciona el tipo</option>
                            <option value="industria">ğŸ­ Industria</option>
                            <option value="comercio">ğŸª Comercio</option>
                            <option value="servicios">âš™ï¸ Servicios</option>
                            <option value="agropecuario">ğŸ” Agropecuario</option>
                            <option value="tecnologia">ğŸ’» TecnologÃ­a</option>
                            <option value="construccion">ğŸ—ï¸ ConstrucciÃ³n</option>
                        </select>
                    </div>
                    
                    <div class="form-field">
                        <label>Estado inicial</label>
                        <div class="status-selector">
                            <div class="status-option active" data-status="operativo">
                                <div class="status-indicator green"></div>
                                <span>Operativo</span>
                            </div>
                            <div class="status-option" data-status="preparacion">
                                <div class="status-indicator yellow"></div>
                                <span>En PreparaciÃ³n</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="grizalum-modal-footer">
            <button class="btn-cancel" onclick="closeAddCompanyModal()">
                <i class="fas fa-times"></i>
                Cancelar
            </button>
            <button class="btn-create" onclick="createNewCompany()">
                <i class="fas fa-plus"></i>
                Crear Empresa
            </button>
        </div>
    </div>
</div>
<!-- SCRIPTS INTEGRADOS --> 
<script src="./src/assets/js/company-manager.js"></script>
<script src="./src/assets/js/charts.js"></script>
<script src="./src/assets/js/main.js"></script>

<!-- SCRIPT PRINCIPAL GRIZALUM - VERSIÃ“N LIMPIA -->
<script>
// ================================================================
// GRIZALUM SISTEMA COMPLETO - VERSIÃ“N CORREGIDA
// ================================================================

// BLOQUEAR PROMPTS DEL NAVEGADOR
window.prompt = function(message) {
    console.log('ğŸš« Prompt bloqueado:', message);
    if (message && message.includes('emoji')) {
        setTimeout(() => showAddCompanyWizard(), 100);
        return 'ğŸ¢';
    }
    return null;
};

// ================================================================
// EMOJI CATEGORIES COMPLETAS - MÃS DE 500 EMOJIS
// ================================================================
const EMOJI_CATEGORIES = {
    business: ['ğŸ¢', 'ğŸ¬', 'ğŸª', 'ğŸ«', 'ğŸ¦', 'ğŸ›ï¸', 'ğŸ¤', 'ğŸ£', 'ğŸ—ï¸', 'ğŸ’¼', 'ğŸ“Š', 'ğŸ“ˆ', 'ğŸ“‰', 'ğŸ’¹', 'ğŸ’°', 'ğŸ’³', 'ğŸ­', 'ğŸ—ï¸', 'ğŸ˜ï¸', 'ğŸšï¸', 'ğŸ ', 'ğŸ¡', 'ğŸŸï¸', 'ğŸï¸', 'ğŸœï¸', 'ğŸï¸', 'ğŸ–ï¸', 'ğŸ•ï¸', 'ğŸ‰', 'ğŸˆ', 'âš½', 'ğŸ€', 'ğŸ¾', 'ğŸ±', 'ğŸ³', 'ğŸ†', 'ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', 'ğŸ…', 'ğŸ–ï¸', 'ğŸµï¸', 'ğŸ—ï¸', 'ğŸ«', 'ğŸŸï¸', 'ğŸª', 'ğŸ­', 'ğŸ¨', 'ğŸ¬', 'ğŸ¤', 'ğŸ§', 'ğŸ¼', 'ğŸµ', 'ğŸ¶', 'ğŸ¹', 'ğŸ¥', 'ğŸ·', 'ğŸº', 'ğŸ¸', 'ğŸª•', 'ğŸ»'],
    industry: ['ğŸ­', 'âš™ï¸', 'ğŸ”§', 'ğŸ”¨', 'â›ï¸', 'ğŸ› ï¸', 'âš¡', 'ğŸ”¥', 'ğŸ’¡', 'ğŸš§', 'âš’ï¸', 'ğŸ§°', 'ğŸ”©', 'ğŸ—ï¸', 'â›½', 'ğŸ›¢ï¸', 'ğŸ”‹', 'ğŸª«', 'ğŸ’¡', 'ğŸ•¯ï¸', 'ğŸª”', 'ğŸ’', 'ğŸ’', 'ğŸ“¿', 'ğŸ’„', 'ğŸ‘‘', 'ğŸ‘’', 'ğŸ©', 'ğŸ“', 'ğŸ§¢', 'â›‘ï¸', 'ğŸ“¢', 'ğŸ“£', 'ğŸ“¯', 'ğŸ””', 'ğŸ”•', 'ğŸµ', 'ğŸ¶', 'ğŸ’¹', 'ğŸ’±', 'ğŸ’²', 'ğŸ’¸', 'ğŸ’´', 'ğŸ’µ', 'ğŸ’¶', 'ğŸ’·', 'ğŸª™', 'ğŸ’°', 'ğŸ’³', 'ğŸ§¾', 'ğŸ’', 'âš–ï¸', 'ğŸ”—', 'â›“ï¸', 'ğŸ§²', 'ğŸ”«', 'ğŸ’£', 'ğŸ§¨', 'ğŸ”ª', 'ğŸ—¡ï¸', 'âš”ï¸', 'ğŸ›¡ï¸', 'ğŸš¬', 'âš±ï¸'],
    commerce: ['ğŸª', 'ğŸ›’', 'ğŸ›ï¸', 'ğŸ’³', 'ğŸ’°', 'ğŸ’µ', 'ğŸ’´', 'ğŸ’¶', 'ğŸ’·', 'ğŸ¬', 'ğŸ“¦', 'ğŸ“®', 'ğŸ', 'ğŸ›ï¸', 'ğŸ·ï¸', 'ğŸ’', 'ğŸ›’', 'ğŸ›ï¸', 'ğŸª', 'ğŸ ', 'ğŸ¡', 'ğŸ¢', 'ğŸš‚', 'ğŸšƒ', 'ğŸš„', 'ğŸš…', 'ğŸš†', 'ğŸš‡', 'ğŸšˆ', 'ğŸš', 'ğŸš', 'ğŸš‹', 'ğŸšŒ', 'ğŸš', 'ğŸš', 'ğŸš', 'ğŸš‘', 'ğŸš’', 'ğŸš“', 'ğŸš”', 'ğŸš•', 'ğŸš–', 'ğŸš—', 'ğŸš˜', 'ğŸš™', 'ğŸ›»', 'ğŸšš', 'ğŸš›', 'ğŸšœ', 'ğŸï¸', 'ğŸï¸', 'ğŸ›µ', 'ğŸ¦½', 'ğŸ¦¼', 'ğŸ›´', 'ğŸš²', 'ğŸ›¹', 'ğŸ›¼', 'ğŸš', 'ğŸ›¸', 'âœˆï¸', 'ğŸ›©ï¸', 'ğŸª‚', 'ğŸ’º', 'ğŸš€', 'ğŸ›°ï¸', 'ğŸš¢', 'â›µ', 'ğŸš¤', 'ğŸ›¥ï¸', 'ğŸ›¶', 'â›´ï¸', 'ğŸš§'],
    food: ['ğŸ', 'ğŸ', 'ğŸ', 'ğŸŠ', 'ğŸ‹', 'ğŸŒ', 'ğŸ‰', 'ğŸ‡', 'ğŸ“', 'ğŸ«', 'ğŸˆ', 'ğŸ’', 'ğŸ‘', 'ğŸ¥­', 'ğŸ', 'ğŸ¥¥', 'ğŸ¥', 'ğŸ…', 'ğŸ†', 'ğŸ¥‘', 'ğŸ¥¦', 'ğŸ¥¬', 'ğŸ¥’', 'ğŸŒ¶ï¸', 'ğŸ«‘', 'ğŸŒ½', 'ğŸ¥•', 'ğŸ«’', 'ğŸ§„', 'ğŸ§…', 'ğŸ¥”', 'ğŸ ', 'ğŸ¥', 'ğŸ¥–', 'ğŸ', 'ğŸ¥¨', 'ğŸ¥¯', 'ğŸ¥', 'ğŸ§‡', 'ğŸ§€', 'ğŸ–', 'ğŸ—', 'ğŸ¥©', 'ğŸ¥“', 'ğŸ”', 'ğŸŸ', 'ğŸ•', 'ğŸŒ­', 'ğŸ¥ª', 'ğŸŒ®', 'ğŸŒ¯', 'ğŸ«”', 'ğŸ¥™', 'ğŸ§†', 'ğŸ¥š', 'ğŸ³', 'ğŸ¥˜', 'ğŸ²', 'ğŸ«•', 'ğŸ¥£', 'ğŸ¥—', 'ğŸ¿', 'ğŸ§ˆ', 'ğŸ§‚', 'ğŸ¥«', 'ğŸ±', 'ğŸ˜', 'ğŸ™', 'ğŸš', 'ğŸ›', 'ğŸœ', 'ğŸ', 'ğŸ ', 'ğŸ¢', 'ğŸ£', 'ğŸ¤', 'ğŸ¥', 'ğŸ¥®', 'ğŸ¡', 'ğŸ¥Ÿ', 'ğŸ¥ ', 'ğŸ¥¡'],
    transport: ['ğŸš—', 'ğŸš•', 'ğŸš™', 'ğŸšŒ', 'ğŸš', 'ğŸï¸', 'ğŸš“', 'ğŸš‘', 'ğŸš’', 'ğŸš', 'ğŸ›»', 'ğŸšš', 'ğŸš›', 'ğŸšœ', 'ğŸï¸', 'ğŸ›µ', 'ğŸš²', 'ğŸ›´', 'ğŸ›¹', 'ğŸ›¼', 'ğŸš', 'âœˆï¸', 'ğŸ›©ï¸', 'ğŸ›«', 'ğŸ›¬', 'ğŸª‚', 'ğŸ’º', 'ğŸš€', 'ğŸ›¸', 'ğŸš¢', 'â›µ', 'ğŸš¤', 'ğŸ›¥ï¸', 'ğŸ›¶', 'â›´ï¸', 'ğŸš§', 'ğŸš¥', 'ğŸš¦', 'ğŸš', 'ğŸ—ºï¸', 'ğŸ—¿', 'ğŸ—½', 'ğŸ—¼', 'ğŸ°', 'ğŸ¯', 'ğŸŸï¸', 'ğŸ¡', 'ğŸ¢', 'ğŸ ', 'â›²', 'â›±ï¸', 'ğŸ–ï¸', 'ğŸï¸', 'ğŸœï¸', 'ğŸŒ‹', 'â›°ï¸', 'ğŸ”ï¸', 'ğŸ—»', 'ğŸ•ï¸', 'â›º', 'ğŸ ', 'ğŸ¡', 'ğŸ˜ï¸', 'ğŸšï¸', 'ğŸ—ï¸', 'ğŸ­', 'ğŸ¢', 'ğŸ¬', 'ğŸ£', 'ğŸ¤', 'ğŸ¥', 'ğŸ¦', 'ğŸ¨', 'ğŸª', 'ğŸ«', 'ğŸ©', 'ğŸ’’', 'ğŸ›ï¸', 'â›ª', 'ğŸ•Œ', 'ğŸ›•', 'ğŸ•', 'â›©ï¸', 'ğŸ•‹'],
    tech: ['ğŸ’»', 'ğŸ–¥ï¸', 'ğŸ–¨ï¸', 'âŒ¨ï¸', 'ğŸ–±ï¸', 'ğŸ’¾', 'ğŸ’¿', 'ğŸ“€', 'ğŸ“±', 'â˜ï¸', 'ğŸ“', 'ğŸ“Ÿ', 'ğŸ“ ', 'ğŸ“º', 'ğŸ“»', 'ğŸ®', 'ğŸ•¹ï¸', 'ğŸ›ï¸', 'â±ï¸', 'â°', 'â²ï¸', 'ğŸ•°ï¸', 'â³', 'âŒ›', 'ğŸ“¡', 'ğŸ”‹', 'ğŸª«', 'ğŸ”Œ', 'ğŸ’¡', 'ğŸ”¦', 'ğŸ•¯ï¸', 'ğŸª”', 'ğŸ§¯', 'ğŸ›¢ï¸', 'ğŸ’¸', 'ğŸ’´', 'ğŸ’µ', 'ğŸ’¶', 'ğŸ’·', 'ğŸª™', 'ğŸ’°', 'ğŸ’³', 'ğŸ§¾', 'ğŸ’', 'âš–ï¸', 'ğŸ¦¯', 'ğŸ”—', 'â›“ï¸', 'ğŸ§²', 'ğŸ”«', 'ğŸ’£', 'ğŸ§¨', 'ğŸ”ª', 'ğŸ—¡ï¸', 'âš”ï¸', 'ğŸ›¡ï¸', 'ğŸš¬', 'âš±ï¸', 'ğŸº', 'ğŸ”®', 'ğŸ“¿', 'ğŸ§¿', 'ğŸ’ˆ', 'âš—ï¸', 'ğŸ”­', 'ğŸ”¬', 'ğŸ•³ï¸', 'ğŸ©¹', 'ğŸ©º', 'ğŸ’Š', 'ğŸ’‰', 'ğŸ§¬', 'ğŸ¦ ', 'ğŸ§«', 'ğŸ§ª', 'ğŸŒ¡ï¸', 'ğŸ§¹', 'ğŸ§´', 'ğŸ§½', 'ğŸ§¯'],
    medical: ['ğŸ¥', 'âš•ï¸', 'ğŸ’Š', 'ğŸ’‰', 'ğŸ©º', 'ğŸ¦·', 'ğŸ§¬', 'ğŸ”¬', 'ğŸ§ª', 'ğŸ§«', 'ğŸ©¹', 'ğŸ©¼', 'ğŸ©»', 'ğŸš‘', 'ğŸ‘¨â€âš•ï¸', 'ğŸ‘©â€âš•ï¸', 'ğŸ§‘â€âš•ï¸', 'ğŸ©¸', 'ğŸ§ ', 'ğŸ«€', 'ğŸ«', 'ğŸ¦´', 'ğŸ‘ï¸', 'ğŸ‘…', 'ğŸ‘‚', 'ğŸ‘ƒ', 'ğŸ¦µ', 'ğŸ¦¶', 'ğŸ¤', 'ğŸ‘Œ', 'ğŸ¤Œ', 'ğŸ¤', 'âœ‹', 'ğŸ–ï¸', 'ğŸ––', 'ğŸ‘‹', 'ğŸ¤™', 'ğŸ’ª', 'ğŸ¦¾', 'ğŸ–•', 'âœï¸', 'ğŸ™', 'ğŸ¦¶', 'ğŸ¦µ', 'ğŸ¦¿', 'ğŸ‘£', 'ğŸ‘¥', 'ğŸ‘¤', 'ğŸ—£ï¸', 'ğŸ‘¶', 'ğŸ§’', 'ğŸ‘¦', 'ğŸ‘§', 'ğŸ§‘', 'ğŸ‘±', 'ğŸ‘¨', 'ğŸ§”', 'ğŸ‘©', 'ğŸ§“', 'ğŸ‘´', 'ğŸ‘µ', 'ğŸ’€', 'â˜ ï¸', 'ğŸ‘»', 'ğŸ‘½', 'ğŸ‘¾', 'ğŸ¤–', 'ğŸƒ', 'ğŸ˜º', 'ğŸ˜¸', 'ğŸ˜¹', 'ğŸ˜»', 'ğŸ˜¼', 'ğŸ˜½', 'ğŸ™€', 'ğŸ˜¿', 'ğŸ˜¾'],
    education: ['ğŸ“', 'ğŸ“š', 'ğŸ“–', 'ğŸ“', 'âœï¸', 'ğŸ“', 'ğŸ“', 'ğŸ“Š', 'ğŸ’', 'ğŸ«', 'ğŸ“‹', 'ğŸ“Œ', 'ğŸ“', 'ğŸ–‡ï¸', 'ğŸ“', 'âœ‚ï¸', 'ğŸ“', 'ğŸ“', 'ğŸ“–', 'ğŸ“—', 'ğŸ“˜', 'ğŸ“™', 'ğŸ“”', 'ğŸ“’', 'ğŸ“•', 'ğŸ““', 'ğŸ“œ', 'ğŸ“ƒ', 'ğŸ“„', 'ğŸ“‘', 'ğŸ—’ï¸', 'ğŸ—“ï¸', 'ğŸ“…', 'ğŸ“†', 'ğŸ—‘ï¸', 'ğŸ“‡', 'ğŸ—ƒï¸', 'ğŸ—³ï¸', 'ğŸ—„ï¸', 'ğŸ“‚', 'ğŸ“', 'ğŸ’¼', 'ğŸ“Š', 'ğŸ“ˆ', 'ğŸ“‰', 'ğŸ“‹', 'ğŸ“Œ', 'ğŸ“', 'ğŸ“', 'ğŸ–‡ï¸', 'ğŸ“', 'ğŸ“', 'âœ‚ï¸', 'ğŸ–Šï¸', 'ğŸ–‹ï¸', 'âœ’ï¸', 'ğŸ–Œï¸', 'ğŸ–ï¸', 'ğŸ“', 'âœï¸', 'ğŸ”', 'ğŸ”', 'ğŸ”’', 'ğŸ”“', 'ğŸ”', 'ğŸ”', 'ğŸ”‘', 'ğŸ—ï¸', 'ğŸ”¨', 'ğŸª“', 'â›ï¸', 'âš’ï¸', 'ğŸ› ï¸', 'ğŸ—¡ï¸', 'âš”ï¸', 'ğŸ”«', 'ğŸ¹', 'ğŸ›¡ï¸', 'ğŸ”§', 'ğŸ”©'],
    animals: ['ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ»â€â„ï¸', 'ğŸ¨', 'ğŸ¯', 'ğŸ¦', 'ğŸ®', 'ğŸ·', 'ğŸ½', 'ğŸ¸', 'ğŸµ', 'ğŸ™ˆ', 'ğŸ™‰', 'ğŸ™Š', 'ğŸ’', 'ğŸ”', 'ğŸ§', 'ğŸ¦', 'ğŸ¤', 'ğŸ£', 'ğŸ¥', 'ğŸ¦†', 'ğŸ¦…', 'ğŸ¦‰', 'ğŸ¦‡', 'ğŸº', 'ğŸ—', 'ğŸ´', 'ğŸ¦„', 'ğŸ', 'ğŸ›', 'ğŸ¦‹', 'ğŸŒ', 'ğŸ', 'ğŸœ', 'ğŸ¦Ÿ', 'ğŸ¦—', 'ğŸ•·ï¸', 'ğŸ•¸ï¸', 'ğŸ¦‚', 'ğŸ¢', 'ğŸ', 'ğŸ¦', 'ğŸ¦–', 'ğŸ¦•', 'ğŸ™', 'ğŸ¦‘', 'ğŸ¦', 'ğŸ¦', 'ğŸ¦€', 'ğŸ¡', 'ğŸ ', 'ğŸŸ', 'ğŸ¬', 'ğŸ³', 'ğŸ‹', 'ğŸ¦ˆ', 'ğŸŠ', 'ğŸ…', 'ğŸ†', 'ğŸ¦“', 'ğŸ¦', 'ğŸ¦§', 'ğŸ˜', 'ğŸ¦›', 'ğŸ¦', 'ğŸª', 'ğŸ«', 'ğŸ¦’', 'ğŸ¦˜', 'ğŸƒ', 'ğŸ‚', 'ğŸ„', 'ğŸ', 'ğŸ–', 'ğŸ', 'ğŸ‘', 'ğŸ¦™', 'ğŸ', 'ğŸ¦Œ', 'ğŸ•', 'ğŸ©', 'ğŸ¦®', 'ğŸ•â€ğŸ¦º', 'ğŸˆ', 'ğŸˆâ€â¬›'],
    nature: ['ğŸŒ±', 'ğŸŒ¿', 'â˜˜ï¸', 'ğŸ€', 'ğŸ', 'ğŸ‹', 'ğŸƒ', 'ğŸ‚', 'ğŸ', 'ğŸ„', 'ğŸŒ¾', 'ğŸ’', 'ğŸŒ·', 'ğŸŒ¹', 'ğŸ¥€', 'ğŸŒº', 'ğŸŒ¸', 'ğŸŒ¼', 'ğŸŒ»', 'ğŸŒ', 'ğŸŒ', 'ğŸŒ›', 'ğŸŒœ', 'ğŸŒš', 'ğŸŒ•', 'ğŸŒ–', 'ğŸŒ—', 'ğŸŒ˜', 'ğŸŒ‘', 'ğŸŒ’', 'ğŸŒ“', 'ğŸŒ”', 'ğŸŒ™', 'ğŸŒ', 'ğŸŒ', 'ğŸŒ', 'ğŸª', 'ğŸ’«', 'â­', 'ğŸŒŸ', 'âœ¨', 'âš¡', 'â˜„ï¸', 'ğŸ’¥', 'ğŸ”¥', 'ğŸŒªï¸', 'ğŸŒˆ', 'â˜€ï¸', 'ğŸŒ¤ï¸', 'â›…', 'ğŸŒ¥ï¸', 'â˜ï¸', 'ğŸŒ¦ï¸', 'ğŸŒ§ï¸', 'â›ˆï¸', 'ğŸŒ©ï¸', 'ğŸŒ¨ï¸', 'â„ï¸', 'â˜ƒï¸', 'â›„', 'ğŸŒ¬ï¸', 'ğŸ’¨', 'ğŸ’§', 'ğŸ’¦', 'â˜”', 'â˜‚ï¸', 'ğŸŒŠ', 'ğŸŒ«ï¸', 'ğŸ', 'ğŸ', 'ğŸ', 'ğŸŠ', 'ğŸ‹', 'ğŸŒ', 'ğŸ‰', 'ğŸ‡', 'ğŸ“', 'ğŸ«', 'ğŸˆ', 'ğŸ’', 'ğŸ‘', 'ğŸ¥­', 'ğŸ', 'ğŸ¥¥', 'ğŸ¥']
};

// ================================================================
// VARIABLES GLOBALES - UNA SOLA VEZ
// ================================================================
let selectedEmojiValue = 'ğŸ¢';
let recentEmojis = JSON.parse(localStorage.getItem('grizalum_recent_emojis') || '["ğŸ¢", "ğŸ­", "ğŸª", "ğŸ’¼", "ğŸšš", "ğŸ’»", "ğŸ¥", "ğŸ“"]');

// ================================================================
// FUNCIONES EMOJI PICKER - ORDEN CORRECTO
// ================================================================
function loadEmojiCategory(category) {
    console.log('ğŸ“± Cargando categorÃ­a ULTRA:', category);
    
    const grid = document.getElementById('emojiGrid');
    if (!grid) {
        console.error('âŒ Grid no encontrado');
        return;
    }
    
    const emojis = EMOJI_CATEGORIES[category] || EMOJI_CATEGORIES.business;
    console.log('ğŸ“¦ Emojis a cargar:', emojis.length);
    
    // RENDERIZADO ULTRA RÃPIDO
    const fragment = document.createDocumentFragment();
    
    // Mostrar MÃS emojis por categorÃ­a
    const maxEmojis = category === 'business' ? emojis.length : Math.min(emojis.length, 120);
    
    for (let i = 0; i < maxEmojis; i++) {
        const emoji = emojis[i];
        const div = document.createElement('div');
        div.className = 'emoji-item';
        div.textContent = emoji;
        div.title = emoji;
        div.onclick = () => selectEmoji(emoji);
        
        // OPTIMIZACIÃ“N: No usar innerHTML
        fragment.appendChild(div);
    }
    
    // ActualizaciÃ³n sÃºper rÃ¡pida
    grid.innerHTML = '';
    grid.appendChild(fragment);
    
    // Actualizar categorÃ­as activas
    document.querySelectorAll('.emoji-cat').forEach(cat => {
        cat.classList.remove('active');
        if (cat.dataset.category === category) {
            cat.classList.add('active');
        }
    });
    
    console.log('âœ… ULTRA categorÃ­a cargada:', maxEmojis, 'emojis de calidad premium');
}
function selectEmoji(emoji) {
    console.log('ğŸ¯ Emoji seleccionado:', emoji);
    
    selectedEmojiValue = emoji;
    
    const display = document.querySelector('.emoji-display');
    const label = document.querySelector('.emoji-label');
    
    if (display && label) {
        display.style.transform = 'scale(0.8) rotate(-10deg)';
        
        setTimeout(() => {
            display.textContent = emoji;
            label.textContent = 'Icono seleccionado';
            display.style.transform = 'scale(1.1) rotate(5deg)';
            
            setTimeout(() => {
                display.style.transform = 'scale(1) rotate(0deg)';
            }, 200);
        }, 150);
    }
    
    addToRecentEmojis(emoji);
    
    setTimeout(() => {
        const picker = document.getElementById('emojiPicker');
        if (picker) picker.classList.remove('show');
    }, 300);
    
    showNotification(`Icono ${emoji} seleccionado`, 'success');
}

function addToRecentEmojis(emoji) {
    recentEmojis = recentEmojis.filter(e => e !== emoji);
    recentEmojis.unshift(emoji);
    recentEmojis = recentEmojis.slice(0, 8);
    
    localStorage.setItem('grizalum_recent_emojis', JSON.stringify(recentEmojis));
    updateRecentEmojis();
}

function updateRecentEmojis() {
    const container = document.getElementById('recentEmojis');
    if (container) {
        const fragment = document.createDocumentFragment();
        
        recentEmojis.forEach(emoji => {
            const div = document.createElement('div');
            div.className = 'emoji-item';
            div.textContent = emoji;
            div.title = `Reciente: ${emoji}`;
            div.onclick = () => selectEmoji(emoji);
            fragment.appendChild(div);
        });
        
        container.innerHTML = '';
        container.appendChild(fragment);
    }
}

function searchEmojis(query) {
    if (!query.trim()) {
        loadEmojiCategory('business');
        return;
    }
    
    console.log('ğŸ” Buscando:', query);
    
    const allEmojis = Object.values(EMOJI_CATEGORIES).flat();
    const uniqueEmojis = [...new Set(allEmojis)];
    const filtered = uniqueEmojis.slice(0, 64);
    
    const grid = document.getElementById('emojiGrid');
    if (grid) {
        const fragment = document.createDocumentFragment();
        
        filtered.forEach(emoji => {
            const div = document.createElement('div');
            div.className = 'emoji-item';
            div.textContent = emoji;
            div.title = `BÃºsqueda: ${emoji}`;
            div.onclick = () => selectEmoji(emoji);
            fragment.appendChild(div);
        });
        
        grid.innerHTML = '';
        grid.appendChild(fragment);
    }
    
    document.querySelectorAll('.emoji-cat').forEach(cat => cat.classList.remove('active'));
}

function forceToggleEmojiPicker() {
    console.log('ğŸš€ Toggle emoji picker');
    
    const picker = document.getElementById('emojiPicker');
    if (!picker) {
        console.error('âŒ Picker no encontrado');
        return;
    }
    
    const isVisible = picker.classList.contains('show');
    
    if (isVisible) {
        picker.classList.remove('show');
        console.log('ğŸ‘† Picker cerrado');
    } else {
        picker.classList.add('show');
        loadEmojiCategory('business');
        updateRecentEmojis();
        console.log('ğŸ‘† Picker abierto');
        
        setTimeout(() => {
            const searchInput = document.getElementById('emojiSearch');
            if (searchInput) searchInput.focus();
        }, 100);
    }
}

// ================================================================
// DATOS DE EMPRESAS
// ================================================================
function getCompaniesData() {
    const saved = localStorage.getItem('grizalum_companies');
    if (saved) {
        return JSON.parse(saved);
    }
    
    const defaultCompanies = {
        'fundicion-laguna': {
            name: 'FundiciÃ³n Laguna',
            icon: 'ğŸ”¥',
            status: 'Operativo',
            theme: { primary: '#dc2626', secondary: '#ea580c' },
            data: { cashFlow: 24500, revenue: 2847293, expenses: 1892847, profit: 954446 }
        },
        'fundicion-joel': {
            name: 'FundiciÃ³n Joel',
            icon: 'ğŸ”¥',
            status: 'Operativo',
            theme: { primary: '#ea580c', secondary: '#f97316' },
            data: { cashFlow: 18300, revenue: 2100000, expenses: 1400000, profit: 700000 }
        },
        'avicola-san-juan': {
            name: 'AvÃ­cola San Juan',
            icon: 'ğŸ”',
            status: 'Operativo',
            theme: { primary: '#059669', secondary: '#10b981' },
            data: { cashFlow: 32100, revenue: 3200000, expenses: 2100000, profit: 1100000 }
        },
        'import-lm': {
            name: 'Import LM',
            icon: 'ğŸ“¦',
            status: 'Operativo',
            theme: { primary: '#8b5cf6', secondary: '#a78bfa' },
            data: { cashFlow: 45200, revenue: 4500000, expenses: 2800000, profit: 1700000 }
        },
        'bodega-central': {
            name: 'Bodega Central',
            icon: 'ğŸª',
            status: 'Regular',
            theme: { primary: '#3b82f6', secondary: '#60a5fa' },
            data: { cashFlow: 15800, revenue: 1800000, expenses: 1200000, profit: 600000 }
        }
    };
    
    saveCompaniesData(defaultCompanies);
    return defaultCompanies;
}

function saveCompaniesData(companies) {
    localStorage.setItem('grizalum_companies', JSON.stringify(companies));
}

// ================================================================
// FUNCIONES PRINCIPALES DEL SISTEMA
// ================================================================
function showAddCompanyWizard() {
    const modal = document.getElementById('addCompanyModal');
    modal.classList.add('show');
    document.getElementById('newCompanyName').value = '';
    document.getElementById('newCompanyType').value = '';
    document.querySelectorAll('.status-option').forEach(opt => opt.classList.remove('active'));
    document.querySelector('.status-option[data-status="operativo"]').classList.add('active');
    console.log('ğŸš€ Wizard abierto');
}

function closeAddCompanyModal() {
    document.getElementById('addCompanyModal').classList.remove('show');
}

function createNewCompany() {
    const name = document.getElementById('newCompanyName').value;
    const type = document.getElementById('newCompanyType').value;
    const status = document.querySelector('.status-option.active').dataset.status;
    
    if (!name || !type) {
        showNotification('âŒ Completa todos los campos', 'error');
        return;
    }
    
    const companyId = name.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
    
    const companies = getCompaniesData();
    companies[companyId] = {
        name: name,
        icon: selectedEmojiValue,
        status: status === 'operativo' ? 'Operativo' : 'En PreparaciÃ³n',
        theme: getThemeForType(type),
        data: { cashFlow: 0, revenue: 0, expenses: 0, profit: 0 }
    };
    
    saveCompaniesData(companies);
    closeAddCompanyModal();
    showNotification(`âœ… Empresa "${name}" creada`, 'success');
}

function getThemeForType(type) {
    const themes = {
        'industria': { primary: '#dc2626', secondary: '#ea580c' },
        'comercio': { primary: '#3b82f6', secondary: '#60a5fa' },
        'servicios': { primary: '#8b5cf6', secondary: '#a78bfa' },
        'agropecuario': { primary: '#059669', secondary: '#10b981' },
        'tecnologia': { primary: '#6366f1', secondary: '#818cf8' },
        'construccion': { primary: '#f59e0b', secondary: '#fbbf24' }
    };
    return themes[type] || { primary: '#d4af37', secondary: '#b87333' };
}

function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `grizalum-notification ${type}`;
    
    const icons = {
        'success': 'fas fa-check-circle',
        'error': 'fas fa-exclamation-circle', 
        'warning': 'fas fa-exclamation-triangle',
        'info': 'fas fa-info-circle'
    };
    
    notification.innerHTML = `
        <div class="notification-content">
            <i class="${icons[type] || icons.info}"></i>
            <span>${message}</span>
        </div>
        <button class="notification-close" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    let container = document.getElementById('notificationContainer');
    if (!container) {
        container = document.createElement('div');
        container.id = 'notificationContainer';
        container.className = 'notification-container';
        document.body.appendChild(container);
    }
    
    container.appendChild(notification);
    setTimeout(() => notification.remove(), 5000);
}

// ================================================================
// FUNCIONES AUXILIARES
// ================================================================
function toggleSidebar() {
    document.getElementById('sidebar').classList.toggle('open');
}

function changePeriod(period, button) {
    document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
    button.classList.add('active');
    console.log(`ğŸ“… PerÃ­odo: ${period}`);
}

function showNotifications() {
    console.log('ğŸ”” Notificaciones');
}

function showSection(section) {
    console.log(`ğŸ“± SecciÃ³n: ${section}`);
}

function toggleAIAssistant() {
    console.log('ğŸ¤– AI Assistant');
}

function setupEventListeners() {
    // Filtros de grÃ¡ficos
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
        });
    });
}

// ================================================================
// INICIALIZACIÃ“N PRINCIPAL - UNA SOLA VEZ
// ================================================================
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸš€ GRIZALUM Iniciando...');
    
    // Ocultar loading
    setTimeout(() => {
        const loading = document.getElementById('loadingScreen');
        if (loading) loading.classList.add('hide');
    }, 3000);
    
    // Inicializar grÃ¡ficos
    setTimeout(() => {
        if (typeof Chart !== 'undefined' && typeof initializeCharts === 'function') {
            try {
                initializeCharts();
                console.log('ğŸ“Š GrÃ¡ficos inicializados');
            } catch (error) {
                console.error('âŒ Error grÃ¡ficos:', error);
            }
        }
    }, 1000);
    
    // Configurar eventos
    setupEventListeners();
    
    // CONFIGURAR EMOJI PICKER
    setTimeout(() => {
        const selectedEmoji = document.getElementById('selectedEmoji');
        if (selectedEmoji) {
            selectedEmoji.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('ğŸ”¥ CLICK EMOJI');
                forceToggleEmojiPicker();
            });
            
            // Eventos de categorÃ­as
            document.querySelectorAll('.emoji-cat').forEach(cat => {
                cat.addEventListener('click', function() {
                    const category = this.dataset.category;
                    loadEmojiCategory(category);
                });
            });
            
            // BÃºsqueda con debounce
            const searchInput = document.getElementById('emojiSearch');
            if (searchInput) {
                let searchTimeout;
                searchInput.addEventListener('input', function() {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        searchEmojis(this.value.toLowerCase());
                    }, 300);
                });
            }
            
            // Cerrar al hacer clic fuera
            document.addEventListener('click', function(e) {
                const picker = document.getElementById('emojiPicker');
                const container = document.querySelector('.emoji-selector-container');
                
                if (container && !container.contains(e.target) && picker) {
                    picker.classList.remove('show');
                }
            });
            
            // Status selector
            document.querySelectorAll('.status-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.status-option').forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Cargar datos iniciales
            loadEmojiCategory('business');
            updateRecentEmojis();
            
            console.log('âœ… Emoji picker configurado');
        }
    }, 1000);
    
    console.log('âœ… GRIZALUM listo');
});

console.log('ğŸ¯ GRIZALUM Sistema LIMPIO cargado');
</script>
</body>
</html>

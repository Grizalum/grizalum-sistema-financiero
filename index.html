<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRIZALUM - Sistema Financiero Empresarial Premium</title>
    
    <!-- Meta Tags SEO -->
    <meta name="description" content="Sistema financiero empresarial premium con IA integrada para empresas peruanas. Dashboard ejecutivo, flujo de caja, an√°lisis predictivo.">
    <meta name="keywords" content="sistema financiero, empresas peru, contabilidad, flujo de caja, dashboard, IA">
    <meta name="author" content="GRIZALUM">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="src/assets/images/favicon.ico">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- FontAwesome -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>
    
    <!-- PWA MANIFEST -->
    <link rel="manifest" href="manifest.json">
    
    <!-- META TAGS PARA PWA -->
    <meta name="application-name" content="GRIZALUM">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="GRIZALUM">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#d4af37">
    <meta name="theme-color" content="#d4af37">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- ICONOS ADICIONALES -->
    <link rel="icon" type="image/png" sizes="32x32" href="src/assets/images/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="src/assets/images/icon-16x16.png">
    <link rel="apple-touch-icon" href="src/assets/images/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="src/assets/images/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="src/assets/images/icon-180x180.png">
    
    <!-- Microsoft tiles -->
    <meta name="msapplication-TileImage" content="src/assets/images/icon-144x144.png">
    <meta name="msapplication-config" content="browserconfig.xml">
    
    <!-- Styles - RUTAS DESDE LA RA√çZ -->
    <link rel="stylesheet" href="src/assets/css/styles.css">
    <link rel="stylesheet" href="src/assets/css/responsive.css">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <div class="brand-icon loading-logo">
                <i class="fas fa-chart-line"></i>
            </div>
            <h1>GRIZALUM</h1>
            <p>Cargando sistema financiero...</p>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
        </div>
    </div>

    <div class="app-container">
        <!-- SIDEBAR -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="company-brand">
                    <div class="brand-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="brand-text">
                        <h1>GRIZALUM</h1>
                        <p>Control Financiero</p>
                    </div>
                </div>
                
                <div class="financial-summary">
                    <div class="summary-item">
                        <span class="summary-label">Flujo de Caja</span>
                        <span class="summary-value" id="sidebarCashFlow">S/. 24,500</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Ingresos Mes</span>
                        <span class="summary-value" id="sidebarRevenue">S/. 45,200</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Gastos Mes</span>
                        <span class="summary-value" id="sidebarExpenses">S/. 28,700</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Utilidad Neta</span>
                        <span class="summary-value" id="sidebarProfit">S/. 16,500</span>
                    </div>
                </div>
            </div>

            <div class="nav-menu">
                <div class="nav-section">
                    <div class="nav-section-title">
                        <i class="fas fa-chart-bar"></i>
                        Panel Principal
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link active" onclick="showSection('dashboard')">
                            <i class="nav-icon fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('cash-flow')">
                            <i class="nav-icon fas fa-water"></i>
                            <span>Flujo de Caja</span>
                        </a>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">
                        <i class="fas fa-calculator"></i>
                        Contabilidad
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('income-statement')">
                            <i class="nav-icon fas fa-chart-pie"></i>
                            <span>Estado de Resultados</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('balance-sheet')">
                            <i class="nav-icon fas fa-balance-scale"></i>
                            <span>Balance General</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('accounts-receivable')">
                            <i class="nav-icon fas fa-coins"></i>
                            <span>Cuentas por Cobrar</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('accounts-payable')">
                            <i class="nav-icon fas fa-credit-card"></i>
                            <span>Cuentas por Pagar</span>
                        </a>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">
                        <i class="fas fa-warehouse"></i>
                        Operaciones
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('inventory')">
                            <i class="nav-icon fas fa-boxes"></i>
                            <span>Inventario</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('sales')">
                            <i class="nav-icon fas fa-shopping-cart"></i>
                            <span>Ventas</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('purchases')">
                            <i class="nav-icon fas fa-truck"></i>
                            <span>Compras</span>
                        </a>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">
                        <i class="fas fa-chart-area"></i>
                        An√°lisis
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('financial-analysis')">
                            <i class="nav-icon fas fa-magnifying-glass-chart"></i>
                            <span>An√°lisis Financiero</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('reports')">
                            <i class="nav-icon fas fa-file-alt"></i>
                            <span>Reportes</span>
                        </a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <header class="executive-header">
                <button class="mobile-menu-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                
                <div class="page-header">
                    <div>
                        <h1 class="page-title" id="pageTitle">Dashboard Ejecutivo</h1>
                        <p class="page-subtitle" id="pageSubtitle">Resumen financiero en tiempo real</p>
                        <div class="ai-insights">
                            <i class="fas fa-brain"></i>
                            <span>IA predice crecimiento del 15% este trimestre</span>
                        </div>
                    </div>
                </div>

                <div class="header-controls">
                    <div class="time-period-selector">
                        <button class="period-btn active" onclick="changePeriod('hoy', this)">Hoy</button>
                        <button class="period-btn" onclick="changePeriod('semana', this)">Semana</button>
                        <button class="period-btn" onclick="changePeriod('mes', this)">Mes</button>
                        <button class="period-btn" onclick="changePeriod('trimestre', this)">Trimestre</button>
                        <button class="period-btn" onclick="changePeriod('a√±o', this)">A√±o</button>
                    </div>

                    <button class="notification-center" onclick="showNotifications()">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </button>

<!-- SELECTOR DE EMPRESAS -->
<div class="company-selector" id="companySelector">
    <div class="selected-company" onclick="toggleCompanyDropdown()">
        <div class="company-info">
            <div class="company-icon" id="currentCompanyIcon">üî•</div>
            <div class="company-details">
                <div class="company-name" id="currentCompanyName">Fundici√≥n Laguna</div>
                <div class="company-status" id="currentCompanyStatus">üü¢ Operativo</div>
            </div>
        </div>
        <div class="dropdown-arrow">
            <i class="fas fa-chevron-down" id="dropdownArrow"></i>
        </div>
    </div>
    
    <div class="company-dropdown" id="companyDropdown">
        <div class="dropdown-header">
            <h4>üè¢ Empresas GRIZALUM</h4>
            <button class="btn-add-company" onclick="showAddCompanyWizard()">
                <i class="fas fa-plus"></i>
                Agregar Nueva
            </button>
        </div>
        
        <div class="companies-list">
            <div class="company-item active" data-company="fundicion-laguna" onclick="selectCompany('fundicion-laguna')">
                <div class="company-item-icon">üî•</div>
                <div class="company-item-info">
                    <div class="company-item-name">Fundici√≥n Laguna</div>
                    <div class="company-item-stats">Flujo: S/. 24,500</div>
                </div>
                <div class="company-item-status">üü¢</div>
            </div>
            
            <div class="company-item" data-company="fundicion-joel" onclick="selectCompany('fundicion-joel')">
                <div class="company-item-icon">üî•</div>
                <div class="company-item-info">
                    <div class="company-item-name">Fundici√≥n Joel</div>
                    <div class="company-item-stats">Flujo: S/. 18,300</div>
                </div>
                <div class="company-item-status">üü¢</div>
            </div>
            
            <div class="company-item" data-company="avicola-san-juan" onclick="selectCompany('avicola-san-juan')">
                <div class="company-item-icon">üêî</div>
                <div class="company-item-info">
                    <div class="company-item-name">Av√≠cola San Juan</div>
                    <div class="company-item-stats">Flujo: S/. 32,100</div>
                </div>
                <div class="company-item-status">üü¢</div>
            </div>
            
            <div class="company-item" data-company="bodega-central" onclick="selectCompany('bodega-central')">
                <div class="company-item-icon">üè™</div>
                <div class="company-item-info">
                    <div class="company-item-name">Bodega Central</div>
                    <div class="company-item-stats">Flujo: S/. 15,800</div>
                </div>
                <div class="company-item-status">üü°</div>
            </div>
            
            <div class="company-item" data-company="importaciones-gz" onclick="selectCompany('importaciones-gz')">
                <div class="company-item-icon">üì¶</div>
                <div class="company-item-info">
                    <div class="company-item-name">Importaciones GZ</div>
                    <div class="company-item-stats">Flujo: S/. 45,200</div>
                </div>
                <div class="company-item-status">üü¢</div>
            </div>
        </div>
        
        <div class="dropdown-footer">
            <div class="total-companies">
                <strong>üìä Total Holding: S/. 135,900</strong>
            </div>
        </div>
    </div>
</div>

<!-- ESTILOS CSS PARA EL SELECTOR -->
<style>
.company-selector {
    position: relative;
    min-width: 280px;
}

.selected-company {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(184, 115, 51, 0.1) 100%);
    border: 2px solid rgba(212, 175, 55, 0.3);
    border-radius: 16px;
    padding: 1rem 1.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.selected-company:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(212, 175, 55, 0.2);
    border-color: rgba(212, 175, 55, 0.5);
}

.company-info {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.company-icon {
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, #d4af37 0%, #b87333 100%);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
}

.company-details {
    display: flex;
    flex-direction: column;
}

.company-name {
    font-size: 1rem;
    font-weight: 700;
    color: var(--gray-800);
    margin-bottom: 0.25rem;
}

.company-status {
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--gray-600);
}

.dropdown-arrow {
    color: var(--gray-600);
    transition: transform 0.3s ease;
}

.dropdown-arrow.rotate {
    transform: rotate(180deg);
}

.company-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    width: 350px;
    background: white;
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    border: 1px solid var(--gray-200);
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(20px);
}

.company-dropdown.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.dropdown-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--gray-200);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.dropdown-header h4 {
    margin: 0;
    color: var(--gray-800);
    font-size: 1.1rem;
    font-weight: 700;
}

.btn-add-company {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
}

.btn-add-company:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.companies-list {
    max-height: 300px;
    overflow-y: auto;
    padding: 0.5rem;
}

.company-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: 0.25rem;
}

.company-item:hover {
    background: var(--gray-50);
    transform: translateX(4px);
}

.company-item.active {
    background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(184, 115, 51, 0.1) 100%);
    border: 1px solid rgba(212, 175, 55, 0.3);
}

.company-item-icon {
    width: 40px;
    height: 40px;
    background: var(--gray-100);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
}

.company-item-info {
    flex: 1;
}

.company-item-name {
    font-weight: 600;
    color: var(--gray-800);
    margin-bottom: 0.25rem;
}

.company-item-stats {
    font-size: 0.8rem;
    color: var(--gray-600);
}

.company-item-status {
    font-size: 1rem;
}

.dropdown-footer {
    padding: 1rem 1.5rem;
    border-top: 1px solid var(--gray-200);
    background: var(--gray-50);
    border-bottom-left-radius: 20px;
    border-bottom-right-radius: 20px;
    text-align: center;
}

.dropdown-footer strong {
    color: var(--gray-800);
    font-size: 0.9rem;
}

/* Responsive */
@media (max-width: 768px) {
    .company-selector {
        min-width: 250px;
    }
    
    .company-dropdown {
        width: 300px;
        right: -50px;
    }
}
</style>

                </div>
            </header>

            <div class="content-area">
                <!-- DASHBOARD SECTION -->
                <section class="page-section active" id="dashboard">
                    <!-- REAL-TIME INDICATOR -->
                    <div style="margin-bottom: 1rem;">
                        <div class="real-time-indicator">
                            <div class="real-time-dot"></div>
                            <span>Datos actualizados hace 2 minutos</span>
                        </div>
                    </div>

                    <!-- KPI CARDS -->
                    <div class="kpi-grid">
                        <div class="kpi-card cash-flow profit-glow micro-interaction">
                            <div class="kpi-header">
                                <div class="kpi-info">
                                    <h3>Flujo de Caja Actual</h3>
                                    <p class="kpi-period">Julio 2025</p>
                                </div>
                                <div class="kpi-icon" style="background: var(--gradient-profit)">
                                    <i class="fas fa-water"></i>
                                </div>
                            </div>
                            <div class="kpi-value kpi-value-animation">S/. 24,500</div>
                            <div class="kpi-change">
                                <div class="change-indicator change-positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>+18.5%</span>
                                </div>
                                <span>vs mes anterior</span>
                            </div>
                            <div class="ai-prediction">
                                <i class="fas fa-brain ai-prediction-icon"></i>
                                <strong>IA predice:</strong> Flujo positivo sostenido pr√≥ximos 3 meses
                            </div>
                        </div>

                        <div class="kpi-card revenue micro-interaction">
                            <div class="kpi-header">
                                <div class="kpi-info">
                                    <h3>Ingresos Totales</h3>
                                    <p class="kpi-period">Julio 2025</p>
                                </div>
                                <div class="kpi-icon" style="background: var(--gradient-blue)">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                            </div>
                            <div class="kpi-value kpi-value-animation">S/. 45,200</div>
                            <div class="kpi-change">
                                <div class="change-indicator change-positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>+12.3%</span>
                                </div>
                                <span>vs mes anterior</span>
                            </div>
                            <div class="ai-prediction">
                                <i class="fas fa-brain ai-prediction-icon"></i>
                                <strong>IA sugiere:</strong> Meta agosto: S/. 52,000 (alcanzable)
                            </div>
                        </div>

                        <div class="kpi-card expenses micro-interaction">
                            <div class="kpi-header">
                                <div class="kpi-info">
                                    <h3>Gastos Operativos</h3>
                                    <p class="kpi-period">Julio 2025</p>
                                </div>
                                <div class="kpi-icon" style="background: var(--gradient-loss)">
                                    <i class="fas fa-chart-line-down"></i>
                                </div>
                            </div>
                            <div class="kpi-value kpi-value-animation">S/. 28,700</div>
                            <div class="kpi-change">
                                <div class="change-indicator change-positive">
                                    <i class="fas fa-arrow-down"></i>
                                    <span>-5.2%</span>
                                </div>
                                <span>vs mes anterior</span>
                            </div>
                            <div class="ai-prediction">
                                <i class="fas fa-brain ai-prediction-icon"></i>
                                <strong>IA alerta:</strong> Gasto en marketing puede optimizarse 15%
                            </div>
                        </div>

                        <div class="kpi-card profit gold-glow micro-interaction">
                            <div class="kpi-header">
                                <div class="kpi-info">
                                    <h3>Utilidad Neta</h3>
                                    <p class="kpi-period">Julio 2025</p>
                                </div>
                                <div class="kpi-icon" style="background: var(--gradient-gold)">
                                    <i class="fas fa-trophy"></i>
                                </div>
                            </div>
                            <div class="kpi-value kpi-value-animation">S/. 16,500</div>
                            <div class="kpi-change">
                                <div class="change-indicator change-positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>+28.7%</span>
                                </div>
                                <span>Margen: 36.5%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 73%" title="Meta anual: 73% completado"></div>
                            </div>
                        </div>
                    </div>

                    <!-- CHARTS SECTION -->
                    <div class="charts-section">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">
                                    <i class="chart-icon fas fa-chart-line"></i>
                                    Tendencia de Ingresos vs Gastos
                                </h3>
                                <div class="real-time-indicator">
                                    <div class="real-time-dot"></div>
                                    <span>Tiempo Real</span>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">
                                    <i class="chart-icon fas fa-chart-pie"></i>
                                    Distribuci√≥n de Gastos
                                </h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="expensesChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">
                                    <i class="chart-icon fas fa-water"></i>
                                    Flujo de Caja Proyectado
                                </h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="cashFlowChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">
                                    <i class="chart-icon fas fa-coins"></i>
                                    Aging Cuentas por Cobrar
                                </h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="agingChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- AI INSIGHTS SECTION -->
                    <div class="executive-card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="card-icon fas fa-brain"></i>
                                Insights de Inteligencia Artificial
                            </h2>
                            <div class="card-actions">
                                <button class="btn btn-primary btn-sm" onclick="generateAIReport()">
                                    <i class="fas fa-magic"></i>
                                    Generar An√°lisis IA
                                </button>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                            <div style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%); padding: 1.5rem; border-radius: 16px; border: 1px solid rgba(99, 102, 241, 0.2);">
                                <h4 style="color: var(--indigo); margin-bottom: 1rem; font-weight: 700;">
                                    <i class="fas fa-chart-line" style="margin-right: 0.5rem;"></i>
                                    Predicci√≥n de Ventas
                                </h4>
                                <p style="color: var(--gray-700); line-height: 1.6;">
                                    Basado en datos hist√≥ricos y tendencias actuales, las ventas de agosto podr√≠an alcanzar <strong>S/. 52,000</strong> (+15% vs julio). 
                                    Recomendaci√≥n: Incrementar inventario de productos estrella.
                                </p>
                            </div>

                            <div style="background: linear-gradient(135deg, rgba(5, 150, 105, 0.1) 0%, rgba(16, 185, 129, 0.1) 100%); padding: 1.5rem; border-radius: 16px; border: 1px solid rgba(5, 150, 105, 0.2);">
                                <h4 style="color: var(--profit); margin-bottom: 1rem; font-weight: 700;">
                                    <i class="fas fa-coins" style="margin-right: 0.5rem;"></i>
                                    Optimizaci√≥n de Cobranzas
                                </h4>
                                <p style="color: var(--gray-700); line-height: 1.6;">
                                    <strong>3 clientes</strong> est√°n cerca del l√≠mite de cr√©dito. Contactar esta semana podr√≠a recuperar 
                                    <strong>S/. 15,200</strong> y mejorar el flujo de caja en 8 d√≠as.
                                </p>
                            </div>

                            <div style="background: linear-gradient(135deg, rgba(217, 119, 6, 0.1) 0%, rgba(245, 158, 11, 0.1) 100%); padding: 1.5rem; border-radius: 16px; border: 1px solid rgba(217, 119, 6, 0.2);">
                                <h4 style="color: var(--warning); margin-bottom: 1rem; font-weight: 700;">
                                    <i class="fas fa-exclamation-triangle" style="margin-right: 0.5rem;"></i>
                                    Alerta de Inventario
                                </h4>
                                <p style="color: var(--gray-700); line-height: 1.6;">
                                    El producto "Material Premium" se agotar√° en <strong>12 d√≠as</strong> al ritmo actual. 
                                    Generar orden de compra por <strong>S/. 8,500</strong> para evitar quiebre de stock.
                                </p>
                            </div>

                            <div style="background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(184, 115, 51, 0.1) 100%); padding: 1.5rem; border-radius: 16px; border: 1px solid rgba(212, 175, 55, 0.2);">
                                <h4 style="color: var(--peru-gold); margin-bottom: 1rem; font-weight: 700;">
                                    <i class="fas fa-chart-bar" style="margin-right: 0.5rem;"></i>
                                    Oportunidad de Ahorro
                                </h4>
                                <p style="color: var(--gray-700); line-height: 1.6;">
                                    Renegociar contrato con proveedor principal podr√≠a ahorrar <strong>S/. 3,200/mes</strong> 
                                    (11% del gasto actual). ROI estimado: 340% anual.
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- CASH FLOW SECTION -->
                <section class="page-section" id="cash-flow">
                    <div class="executive-card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="card-icon fas fa-water"></i>
                                Gesti√≥n de Flujo de Caja
                            </h2>
                            <div class="card-actions">
                                <button class="btn btn-success" onclick="exportCashFlow()">
                                    <i class="fas fa-download"></i>
                                    Exportar
                                </button>
                                <button class="btn btn-primary" onclick="showCashFlowForm()">
                                    <i class="fas fa-plus"></i>
                                    Nueva Transacci√≥n
                                </button>
                            </div>
                        </div>

                        <!-- CASH FLOW TABLE -->
                        <table class="financial-table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Descripci√≥n</th>
                                    <th>Categor√≠a</th>
                                    <th>Tipo</th>
                                    <th>Entrada</th>
                                    <th>Salida</th>
                                    <th>Saldo</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="cashFlowTableBody">
                                <tr>
                                    <td>17/07/2025</td>
                                    <td>Venta productos julio</td>
                                    <td>Ventas</td>
                                    <td>Operativo</td>
                                    <td style="color: var(--profit); font-weight: 700;">+S/. 15,200</td>
                                    <td>-</td>
                                    <td style="color: var(--profit); font-weight: 700;">S/. 24,500</td>
                                    <td>
                                        <button class="btn btn-sm btn-neutral micro-interaction" onclick="editTransaction(1)">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- OTHER SECTIONS -->
                <section class="page-section" id="income-statement">
                    <div class="executive-card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="card-icon fas fa-chart-pie"></i>
                                Estado de Resultados
                            </h2>
                        </div>
                        <div class="empty-state-executive">
                            <div class="empty-state-icon">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                            <h3 class="empty-state-title">M√≥dulo en Desarrollo</h3>
                            <p class="empty-state-subtitle">El Estado de Resultados estar√° disponible pr√≥ximamente.</p>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- IA CONVERSACIONAL FUNCIONAL -->

    <!-- BOT√ìN FLOTANTE DE IA -->
    <div id="aiAssistantButton" class="ai-assistant-button" onclick="toggleAIAssistant()">
        <div class="ai-icon">
            <i class="fas fa-brain"></i>
        </div>
        <div class="ai-pulse"></div>
    </div>

    <!-- PANEL DEL ASISTENTE IA -->
    <div id="aiAssistantPanel" class="ai-assistant-panel">
        <div class="ai-panel-header">
            <div class="ai-avatar">
                <i class="fas fa-robot"></i>
            </div>
            <div class="ai-info">
                <h4>GRIZALUM IA</h4>
                <p>Listo para ayudarte</p>
            </div>
            <div class="ai-controls">
                <button class="ai-control-btn" onclick="toggleColorPalette()" title="Cambiar colores">
                    <i class="fas fa-palette"></i>
                </button>
                <button class="ai-control-btn" onclick="clearAIChat()">
                    <i class="fas fa-broom"></i>
                </button>
                <button class="ai-control-btn" onclick="toggleAIAssistant()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <div class="ai-insights-section">
            <h5>üéØ Insights Autom√°ticos</h5>
            <div id="aiInsights" class="ai-insights-container">
                <div class="ai-insight-item success">
                    <div style="font-weight: 600; margin-bottom: 0.25rem;">üìà Flujo de caja estable este mes</div>
                    <div style="font-size: 0.7rem; opacity: 0.8;">üí° Ver detalles</div>
                </div>
                <div class="ai-insight-item info">
                    <div style="font-weight: 600; margin-bottom: 0.25rem;">üéØ IA lista para analizar tus datos</div>
                    <div style="font-size: 0.7rem; opacity: 0.8;">üí° Comenzar an√°lisis</div>
                </div>
            </div>
        </div>

        <div class="ai-chat-container">
            <div class="ai-chat-messages" id="aiChatMessages">
                <div class="ai-message">
                    <div class="ai-message-avatar">ü§ñ</div>
                    <div class="ai-message-content">
                        <p>¬°Hola! Soy tu asistente financiero IA especializado en empresas peruanas. Puedo ayudarte con:</p>
                        <div class="ai-quick-actions">
                            <button class="quick-action-btn" onclick="askAI('¬øC√≥mo van mis ventas?')">üìà ¬øC√≥mo van las ventas?</button>
                            <button class="quick-action-btn" onclick="askAI('¬øPuedo invertir m√°s dinero?')">üí∞ ¬øPuedo invertir?</button>
                            <button class="quick-action-btn" onclick="askAI('¬øC√≥mo est√° mi flujo de caja?')">üíß Flujo de caja</button>
                            <button class="quick-action-btn" onclick="askAI('Dame predicciones para el pr√≥ximo mes')">üîÆ Predicciones</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="ai-chat-input">
                <div class="ai-input-container">
                    <input type="text" id="aiChatInput" placeholder="Preg√∫ntame sobre tu empresa..." 
                           onkeydown="handleAIChatKeypress(event)">
                    <button class="ai-send-btn" onclick="sendAIMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                    <button class="ai-voice-btn" onclick="startVoiceInput()" id="voiceInputBtn">
                        <i class="fas fa-microphone"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ESTILOS PARA IA -->
    <style>
    .ai-assistant-button {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 70px;
        height: 70px;
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
        z-index: 1000;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: visible;
    }

    .ai-assistant-button:hover {
        transform: translateY(-5px) scale(1.1);
        box-shadow: 0 15px 40px rgba(99, 102, 241, 0.6);
    }

    .ai-icon {
        color: white;
        font-size: 1.8rem;
        z-index: 2;
    }

    .ai-pulse {
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        opacity: 0.7;
        animation: aiPulse 2s infinite;
    }

    @keyframes aiPulse {
        0% { transform: scale(1); opacity: 0.7; }
        50% { transform: scale(1.2); opacity: 0.3; }
        100% { transform: scale(1.4); opacity: 0; }
    }

    .ai-assistant-panel {
        position: fixed;
        bottom: 120px;
        right: 30px;
        width: 500px;
        height: 700px;
        background: white;
        border-radius: 24px;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        z-index: 999;
        opacity: 0;
        visibility: hidden;
        transform: translateY(20px) scale(0.95);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: hidden;
        border: 1px solid var(--gray-200);
    }

    .ai-assistant-panel.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(0) scale(1);
    }

    .ai-panel-header {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        color: white;
        padding: 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .ai-avatar {
        width: 50px;
        height: 50px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }

    .ai-info {
        flex: 1;
    }

    .ai-info h4 {
        margin: 0 0 0.25rem 0;
        font-size: 1.1rem;
        font-weight: 700;
    }

    .ai-info p {
        margin: 0;
        font-size: 0.9rem;
        opacity: 0.9;
    }

    .ai-controls {
        display: flex;
        gap: 0.5rem;
    }

    .ai-control-btn {
        width: 36px;
        height: 36px;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        border-radius: 8px;
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }

    .ai-control-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.1);
    }

    .ai-insights-section {
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--gray-200);
        background: var(--gray-50);
    }

    .ai-insights-section h5 {
        margin: 0 0 1rem 0;
        color: var(--gray-800);
        font-size: 0.9rem;
        font-weight: 700;
    }

    .ai-insights-container {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        max-height: 120px;
        overflow-y: auto;
    }

    .ai-insight-item {
        background: white;
        padding: 0.75rem;
        border-radius: 8px;
        font-size: 0.8rem;
        border-left: 3px solid;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .ai-insight-item:hover {
        transform: translateX(4px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .ai-insight-item.success { border-color: #10b981; background: rgba(16, 185, 129, 0.05); }
    .ai-insight-item.warning { border-color: #f59e0b; background: rgba(245, 158, 11, 0.05); }
    .ai-insight-item.info { border-color: #3b82f6; background: rgba(59, 130, 246, 0.05); }
    .ai-insight-item.danger { border-color: #ef4444; background: rgba(239, 68, 68, 0.05); }

    .ai-chat-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        height: calc(100% - 200px);
    }

    .ai-chat-messages {
        flex: 1;
        padding: 1rem;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .ai-message, .user-message {
        display: flex;
        gap: 0.75rem;
        align-items: flex-start;
    }

    .user-message {
        flex-direction: row-reverse;
    }

    .ai-message-avatar, .user-message-avatar {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        flex-shrink: 0;
    }

    .ai-message-avatar {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        color: white;
    }

    .user-message-avatar {
        background: var(--peru-gold);
        color: white;
    }

    .ai-message-content, .user-message-content {
        background: var(--gray-50);
        padding: 0.75rem 1rem;
        border-radius: 12px;
        max-width: 280px;
        font-size: 0.9rem;
        line-height: 1.4;
    }

    .user-message-content {
        background: linear-gradient(135deg, #d4af37 0%, #b87333 100%);
        color: white;
    }

    .ai-message-content p {
        margin: 0 0 0.5rem 0;
    }

    .ai-message-content p:last-child {
        margin-bottom: 0;
    }

    .ai-quick-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.75rem;
    }

    .quick-action-btn {
        background: white;
        border: 1px solid var(--gray-300);
        padding: 0.5rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.3s ease;
        color: var(--gray-700);
    }

    .quick-action-btn:hover {
        background: var(--peru-gold);
        color: white;
        border-color: var(--peru-gold);
        transform: translateY(-1px);
    }

    .ai-chat-input {
        padding: 1rem;
        border-top: 1px solid var(--gray-200);
        background: white;
    }

    .ai-input-container {
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }

    .ai-input-container input {
        flex: 1;
        padding: 0.75rem 1rem;
        border: 2px solid var(--gray-200);
        border-radius: 20px;
        font-size: 0.9rem;
        outline: none;
        transition: all 0.3s ease;
    }

    .ai-input-container input:focus {
        border-color: #6366f1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .ai-send-btn, .ai-voice-btn {
        width: 40px;
        height: 40px;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }

    .ai-send-btn {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        color: white;
    }

    .ai-voice-btn {
        background: var(--gray-200);
        color: var(--gray-600);
    }

    .ai-voice-btn.active {
        background: #ef4444;
        color: white;
        animation: voicePulse 1s infinite;
    }

    @keyframes voicePulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }

    .ai-send-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
    }

    .ai-voice-btn:hover {
        background: var(--gray-300);
    }

    .typing-indicator {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 8px 0;
    }

    .typing-indicator span {
        height: 8px;
        width: 8px;
        background: #6b7280;
        border-radius: 50%;
        display: inline-block;
        animation: typing 1.4s infinite ease-in-out;
    }

    .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
    .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
    .typing-indicator span:nth-child(3) { animation-delay: 0s; }

    @keyframes typing {
        0%, 80%, 100% { 
            transform: scale(0.8);
            opacity: 0.5;
        }
        40% { 
            transform: scale(1);
            opacity: 1;
        }
    }

    /* Responsive */
    @media (max-width: 768px) {
        .ai-assistant-panel {
            bottom: 20px;
            right: 20px;
            left: 20px;
            width: auto;
            height: 70vh;
        }
        
        .ai-assistant-button {
            bottom: 20px;
            right: 20px;
        }
    }
    </style>

    <!-- JAVASCRIPT FUNCIONAL -->
    <script>
    // ======= IA CONVERSACIONAL GRIZALUM - VERSI√ìN FUNCIONAL =======

    // VARIABLES GLOBALES
    const colorPalettes = [
        { name: 'Oro Empresarial', primary: '#d4af37', secondary: '#b87333' },
        { name: 'Verde Prosperidad', primary: '#059669', secondary: '#10b981' },
        { name: 'Azul Corporativo', primary: '#1e40af', secondary: '#3b82f6' },
        { name: 'P√∫rpura Premium', primary: '#7c3aed', secondary: '#8b5cf6' },
        { name: 'Rojo Din√°mico', primary: '#dc2626', secondary: '#ef4444' },
        { name: 'Naranja Energ√©tico', primary: '#ea580c', secondary: '#f97316' },
        { name: 'Turquesa Moderno', primary: '#0891b2', secondary: '#06b6d4' },
        { name: 'Rosa Innovador', primary: '#ec4899', secondary: '#f472b6' }
    ];

    let currentPaletteIndex = 0;
    let recognition = null;
    let isRecording = false;

    // FUNCI√ìN TOGGLE IA
    function toggleAIAssistant() {
        console.log('ü§ñ Toggling IA');
        
        const panel = document.getElementById('aiAssistantPanel');
        if (!panel) {
            console.error('‚ùå Panel IA no encontrado');
            return;
        }
        
        panel.classList.toggle('show');
        console.log('‚úÖ Panel IA toggled');
    }

    // ENVIAR MENSAJE IA
    function sendAIMessage() {
        console.log('üì§ Enviando mensaje...');
        
        const input = document.getElementById('aiChatInput');
        if (!input) {
            console.error('‚ùå Input no encontrado');
            return;
        }
        
        const message = input.value.trim();
        if (!message) {
            console.log('‚ö†Ô∏è Mensaje vac√≠o');
            return;
        }
        
        console.log('üí¨ Mensaje:', message);
        
        // Agregar mensaje del usuario
        addChatMessage(message, 'user');
        
        // Limpiar input
        input.value = '';
        
        // Mostrar que IA est√° escribiendo
        showTypingIndicator();
        
        // Generar respuesta despu√©s de 1.5 segundos
        setTimeout(() => {
            hideTypingIndicator();
            const response = generateSmartAIResponse(message);
            addChatMessage(response, 'ai');
        }, 1500);
    }

    // MOSTRAR INDICADOR DE ESCRITURA
    function showTypingIndicator() {
        const container = document.getElementById('aiChatMessages');
        const typingDiv = document.createElement('div');
        typingDiv.id = 'typingIndicator';
        typingDiv.className = 'ai-message';
        typingDiv.innerHTML = `
            <div class="ai-message-avatar">ü§ñ</div>
            <div class="ai-message-content">
                <div class="typing-indicator">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        `;
        container.appendChild(typingDiv);
        container.scrollTop = container.scrollHeight;
    }

    // OCULTAR INDICADOR DE ESCRITURA
    function hideTypingIndicator() {
        const typing = document.getElementById('typingIndicator');
        if (typing) {
            typing.remove();
        }
    }

    // AGREGAR MENSAJE AL CHAT
    function addChatMessage(message, sender) {
        console.log(`üí¨ Agregando mensaje de ${sender}`);
        
        const container = document.getElementById('aiChatMessages');
        if (!container) return;
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `${sender}-message`;
        
        const avatar = sender === 'ai' ? 'ü§ñ' : 'üë§';
        const avatarClass = sender === 'ai' ? 'ai-message-avatar' : 'user-message-avatar';
        const contentClass = sender === 'ai' ? 'ai-message-content' : 'user-message-content';
        
        messageDiv.innerHTML = `
            <div class="${avatarClass}">${avatar}</div>
            <div class="${contentClass}">
                <p>${message}</p>
            </div>
        `;
        
        container.appendChild(messageDiv);
        container.scrollTop = container.scrollHeight;
        
        // Animaci√≥n suave
        messageDiv.style.opacity = '0';
        messageDiv.style.transform = 'translateY(20px)';
        setTimeout(() => {
            messageDiv.style.transition = 'all 0.3s ease';
            messageDiv.style.opacity = '1';
            messageDiv.style.transform = 'translateY(0)';
        }, 100);
    }

    // GENERAR RESPUESTA INTELIGENTE DE IA
    function generateSmartAIResponse(userMessage) {
        const message = userMessage.toLowerCase();
        const currentCompany = getCurrentSelectedCompany();
        const companies = getCompaniesData();
        const company = companies[currentCompany];
        
        console.log('üß† Generando respuesta para:', message);
        
        // RESPUESTAS SOBRE VENTAS
        if (message.includes('ventas') || message.includes('vender') || message.includes('ingresos')) {
            if (company) {
                const growth = Math.random() > 0.5 ? 'crecimiento' : 'estabilidad';
                const percentage = (Math.random() * 25 + 5).toFixed(1);
                const advice = growth === 'crecimiento' ? 
                    'Recomiendo mantener esta estrategia y considerar expansi√≥n.' : 
                    'Sugiero implementar nuevas estrategias de marketing digital.';
                
                return `üìà **An√°lisis de Ventas - ${company.name}**

Las ventas actuales son S/. ${company.data.revenue.toLocaleString()} con una tendencia de ${growth} del ${percentage}%.

${advice}

**Recomendaciones:**
‚Ä¢ Enf√≥cate en productos de mayor margen
‚Ä¢ Implementa programas de fidelizaci√≥n
‚Ä¢ Considera promociones estacionales`;
            }
            return 'üìä Selecciona una empresa espec√≠fica para analizar sus ventas en detalle.';
        }
        
        // RESPUESTAS SOBRE FLUJO DE CAJA
        if (message.includes('flujo') || message.includes('caja') || message.includes('liquidez')) {
            if (company) {
                const health = company.data.cashFlow > 25000 ? 'excelente' : 
                              company.data.cashFlow > 15000 ? 'bueno' : 'necesita atenci√≥n';
                const color = company.data.cashFlow > 25000 ? 'üü¢' : 
                             company.data.cashFlow > 15000 ? 'üü°' : 'üî¥';
                
                return `üíß **Flujo de Caja - ${company.name}**

${color} Estado: ${health.toUpperCase()}
üí∞ Disponible: S/. ${company.data.cashFlow.toLocaleString()}

**An√°lisis:**
${company.data.cashFlow > 25000 ? 
    '‚Ä¢ Excelente liquidez para inversiones\n‚Ä¢ Considera expansi√≥n o nuevos equipos\n‚Ä¢ Mant√©n reserva del 20% para emergencias' :
    '‚Ä¢ Acelera cobranzas pendientes\n‚Ä¢ Revisa gastos no esenciales\n‚Ä¢ Negocia mejores t√©rminos con proveedores'}`;
            }
            return 'üí∞ Necesito que selecciones una empresa para revisar su flujo de caja.';
        }
        
        // RESPUESTAS SOBRE INVERSI√ìN
        if (message.includes('invertir') || message.includes('inversi√≥n') || message.includes('expandir')) {
            if (company) {
                const canInvest = company.data.cashFlow > 30000;
                const riskLevel = company.data.profit / company.data.revenue > 0.2 ? 'bajo' : 'moderado';
                
                return `üí° **An√°lisis de Inversi√≥n - ${company.name}**

${canInvest ? '‚úÖ RECOMENDADO' : '‚ö†Ô∏è PRECAUCI√ìN'}

**Capacidad actual:**
‚Ä¢ Flujo disponible: S/. ${company.data.cashFlow.toLocaleString()}
‚Ä¢ Margen de ganancia: ${((company.data.profit/company.data.revenue)*100).toFixed(1)}%
‚Ä¢ Nivel de riesgo: ${riskLevel}

**Recomendaci√≥n:**
${canInvest ? 
    'Puedes invertir hasta S/. ' + Math.floor(company.data.cashFlow * 0.6).toLocaleString() + ' manteniendo liquidez segura.' :
    'Fortalece primero el flujo de caja antes de inversiones grandes. Enf√≥cate en optimizar operaciones actuales.'}`;
            }
            return 'üí° Selecciona una empresa para evaluar su capacidad de inversi√≥n.';
        }
        
        // RESPUESTAS SOBRE GASTOS
        if (message.includes('gastos') || message.includes('costos') || message.includes('reducir')) {
            if (company) {
                const expenseRatio = (company.data.expenses / company.data.revenue * 100).toFixed(1);
                const efficiency = expenseRatio < 60 ? 'excelente' : expenseRatio < 75 ? 'buena' : 'necesita mejora';
                
                return `üí∏ **An√°lisis de Gastos - ${company.name}**

üìä Gastos actuales: S/. ${company.data.expenses.toLocaleString()}
üìà Porcentaje de ingresos: ${expenseRatio}%
‚ö° Eficiencia: ${efficiency}

**Oportunidades de optimizaci√≥n:**
‚Ä¢ Renegociar contratos con proveedores principales
‚Ä¢ Automatizar procesos repetitivos
‚Ä¢ Revisar gastos de marketing menos efectivos
‚Ä¢ Considerar equipos m√°s eficientes energ√©ticamente`;
            }
            return 'üí∏ Elige una empresa para analizar sus gastos y encontrar oportunidades de ahorro.';
        }
        
        // RESPUESTAS SOBRE PREDICCIONES
        if (message.includes('futuro') || message.includes('predicci√≥n') || message.includes('pron√≥stico')) {
            if (company) {
                const trend = Math.random() > 0.5 ? 'positiva' : 'estable';
                const nextMonth = Math.round(company.data.revenue * (trend === 'positiva' ? 1.15 : 1.05));
                
                return `üîÆ **Predicci√≥n Financiera - ${company.name}**

**Pr√≥ximo mes:**
üìà Ingresos proyectados: S/. ${nextMonth.toLocaleString()}
üìä Tendencia: ${trend}
üéØ Confianza: 85%

**Factores considerados:**
‚Ä¢ Tendencias hist√≥ricas de la empresa
‚Ä¢ Estacionalidad del sector
‚Ä¢ Condiciones del mercado peruano
‚Ä¢ Indicadores econ√≥micos actuales

**Recomendaci√≥n:** ${trend === 'positiva' ? 'Prep√°rate para el crecimiento aumentando inventario' : 'Mant√©n operaciones estables y enf√≥cate en eficiencia'}`;
            }
            return 'üîÆ Selecciona una empresa para generar predicciones espec√≠ficas basadas en sus datos.';
        }
        
        // RESPUESTAS DE SALUDO
        if (message.includes('hola') || message.includes('buenos') || message.includes('buenas')) {
            const greetings = [
                '¬°Hola! üëã Soy tu asistente financiero inteligente. Puedo ayudarte con an√°lisis de ventas, flujo de caja, predicciones y estrategias de crecimiento.',
                '¬°Saludos! üöÄ Estoy aqu√≠ para optimizar las finanzas de tu empresa. ¬øQu√© aspecto de tu negocio quieres revisar?',
                '¬°Buen d√≠a! üìä Especialista en an√°lisis empresarial a tu servicio. ¬øComenzamos con un an√°lisis de rentabilidad?'
            ];
            return greetings[Math.floor(Math.random() * greetings.length)];
        }
        
        // RESPUESTAS DE AGRADECIMIENTO
        if (message.includes('gracias') || message.includes('thank')) {
            return 'üòä ¬°Siempre a tu servicio! Estoy disponible 24/7 para ayudarte a hacer crecer tu negocio. ¬øHay algo m√°s que pueda analizar para ti?';
        }
        
        // RESPUESTA POR DEFECTO INTELIGENTE
        const defaultResponses = [
            `ü§î Entiendo que preguntas sobre "${userMessage}". Puedo ayudarte con:

üìà **An√°lisis de Ventas** - Tendencias y oportunidades
üíß **Flujo de Caja** - Liquidez y gesti√≥n financiera  
üí° **Estrategias de Inversi√≥n** - Cu√°ndo y d√≥nde invertir
üîÆ **Predicciones** - Proyecciones basadas en datos
üí∏ **Optimizaci√≥n de Gastos** - Reducir costos sin afectar calidad

¬øSobre cu√°l de estos temas te gustar√≠a que profundice?`,
            
            `üí° Interesante consulta sobre "${userMessage}". Para darte la mejor respuesta, ¬øte refieres a:

‚Ä¢ **An√°lisis financiero** de una empresa espec√≠fica
‚Ä¢ **Comparaci√≥n** entre tus diferentes negocios  
‚Ä¢ **Estrategias** para mejorar rentabilidad
‚Ä¢ **Predicciones** de crecimiento futuro

¬°Dime qu√© necesitas y te ayudo con datos precisos!`
        ];
        
        return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
    }

    // MANEJAR TECLA ENTER
    function handleAIChatKeypress(event) {
        if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault();
            sendAIMessage();
        }
    }

    // BOTONES R√ÅPIDOS
    function askAI(question) {
        const input = document.getElementById('aiChatInput');
        if (input) {
            input.value = question;
            sendAIMessage();
        }
    }

    // LIMPIAR CHAT
    function clearAIChat() {
        const container = document.getElementById('aiChatMessages');
        if (!container) return;
        
        container.innerHTML = `
            <div class="ai-message">
                <div class="ai-message-avatar">ü§ñ</div>
                <div class="ai-message-content">
                    <p>Chat reiniciado. Soy tu asistente financiero IA especializado en empresas peruanas. ¬øEn qu√© puedo ayudarte?</p>
                    <div class="ai-quick-actions">
                        <button class="quick-action-btn" onclick="askAI('¬øC√≥mo van mis ventas?')">üìà Analizar Ventas</button>
                        <button class="quick-action-btn" onclick="askAI('¬øPuedo invertir m√°s dinero?')">üí∞ ¬øPuedo Invertir?</button>
                        <button class="quick-action-btn" onclick="askAI('¬øC√≥mo est√° mi flujo de caja?')">üíß Flujo de Caja</button>
                        <button class="quick-action-btn" onclick="askAI('Dame predicciones para el pr√≥ximo mes')">üîÆ Predicciones</button>
                    </div>
                </div>
            </div>
        `;
    }

    // ======= SISTEMA DE CAMBIO DE COLORES ALEATORIO =======

    // CAMBIAR PALETA ALEATORIAMENTE
    function toggleColorPalette() {
        console.log('üé® Cambiando paleta de colores...');
        
        // Seleccionar paleta aleatoria (diferente a la actual)
        let newIndex;
        do {
            newIndex = Math.floor(Math.random() * colorPalettes.length);
        } while (newIndex === currentPaletteIndex);
        
        currentPaletteIndex = newIndex;
        const palette = colorPalettes[newIndex];
        
        applyColorPalette(palette);
        
        // Mostrar notificaci√≥n
        showColorChangeNotification(palette.name);
    }

    // APLICAR PALETA DE COLORES
    function applyColorPalette(palette) {
        console.log(`üé® Aplicando: ${palette.name}`);
        
        // Actualizar variables CSS
        document.documentElement.style.setProperty('--peru-gold', palette.primary);
        document.documentElement.style.setProperty('--company-primary', palette.primary);
        document.documentElement.style.setProperty('--company-secondary', palette.secondary);
        
        // Actualizar botones principales
        const buttons = document.querySelectorAll('.btn-primary, .btn-add-company');
        buttons.forEach(btn => {
            btn.style.background = `linear-gradient(135deg, ${palette.primary} 0%, ${palette.secondary} 100%)`;
        });
        
        // Actualizar bot√≥n IA
        const aiButton = document.getElementById('aiAssistantButton');
        if (aiButton) {
            aiButton.style.background = `linear-gradient(135deg, ${palette.primary} 0%, ${palette.secondary} 100%)`;
        }
        
        // Actualizar header IA
        const aiHeader = document.querySelector('.ai-panel-header');
        if (aiHeader) {
            aiHeader.style.background = `linear-gradient(135deg, ${palette.primary} 0%, ${palette.secondary} 100%)`;
        }
        
        // Actualizar selector de empresa
        const selectedCompany = document.querySelector('.selected-company');
        if (selectedCompany) {
            selectedCompany.style.borderColor = palette.primary + '80'; // 50% transparencia
        }
        
        // Guardar preferencia
        localStorage.setItem('grizalum_current_palette', JSON.stringify(palette));
        
        console.log('‚úÖ Paleta aplicada correctamente');
    }

    // MOSTRAR NOTIFICACI√ìN DE CAMBIO DE COLOR
    function showColorChangeNotification(paletteName) {
        // Crear notificaci√≥n temporal
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--company-primary), var(--company-secondary));
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 10000;
            font-weight: 600;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        `;
        
        notification.innerHTML = `
            üé® Paleta cambiada a: ${paletteName}
        `;
        
        document.body.appendChild(notification);
        
        // Animar entrada
        setTimeout(() => {
            notification.style.transform = 'translateX(0)';
        }, 100);
        
        // Quitar despu√©s de 3 segundos
        setTimeout(() => {
            notification.style.transform = 'translateX(100%)';
            setTimeout(() => {
                notification.remove();
            }, 300);
        }, 3000);
    }

    // ======= RECONOCIMIENTO DE VOZ =======

    function initializeVoiceRecognition() {
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'es-PE';
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                const input = document.getElementById('aiChatInput');
                if (input) {
                    input.value = transcript;
                    stopVoiceInput();
                    setTimeout(() => sendAIMessage(), 500);
                }
            };
            
            recognition.onerror = function(event) {
                console.warn('Error de voz:', event.error);
                stopVoiceInput();
                addChatMessage('‚ùå Error en reconocimiento de voz. Intenta nuevamente.', 'ai');
            };
            
            recognition.onend = function() {
                stopVoiceInput();
            };
            
            console.log('üé§ Reconocimiento de voz listo');
        }
    }

    function startVoiceInput() {
        if (!recognition) {
            addChatMessage('‚ùå Reconocimiento de voz no disponible.', 'ai');
            return;
        }
        
        if (isRecording) {
            stopVoiceInput();
            return;
        }
        
        isRecording = true;
        const button = document.getElementById('voiceInputBtn');
        if (button) {
            button.style.background = '#ef4444';
            button.innerHTML = '<i class="fas fa-stop"></i>';
            button.classList.add('active');
        }
        
        recognition.start();
        addChatMessage('üé§ Escuchando... Habla ahora', 'ai');
    }

    function stopVoiceInput() {
        isRecording = false;
        if (recognition) recognition.stop();
        
        const button = document.getElementById('voiceInputBtn');
        if (button) {
            button.style.background = '#6b7280';
            button.innerHTML = '<i class="fas fa-microphone"></i>';
            button.classList.remove('active');
        }
    }

    // ======= FUNCIONES AUXILIARES =======

    function getCurrentSelectedCompany() {
        const activeItem = document.querySelector('.company-item.active');
        return activeItem ? activeItem.dataset.company : 'fundicion-laguna';
    }

    function getCompaniesData() {
        return {
            'fundicion-laguna': {
                name: 'Fundici√≥n Laguna',
                icon: 'üî•',
                status: 'Operativo',
                theme: { primary: '#dc2626', secondary: '#ea580c' },
                data: {
                    cashFlow: 24500,
                    revenue: 45200,
                    expenses: 28700,
                    profit: 16500
                }
            },
            'fundicion-joel': {
                name: 'Fundici√≥n Joel',
                icon: 'üî•',
                status: 'Operativo',
                theme: { primary: '#ea580c', secondary: '#f97316' },
                data: {
                    cashFlow: 18300,
                    revenue: 32100,
                    expenses: 21800,
                    profit: 10300
                }
            },
            'avicola-san-juan': {
                name: 'Av√≠cola San Juan',
                icon: 'üêî',
                status: 'Operativo',
                theme: { primary: '#059669', secondary: '#10b981' },
                data: {
                    cashFlow: 32100,
                    revenue: 58300,
                    expenses: 41200,
                    profit: 17100
                }
            },
            'bodega-central': {
                name: 'Bodega Central',
                icon: 'üè™',
                status: 'Regular',
                theme: { primary: '#3b82f6', secondary: '#60a5fa' },
                data: {
                    cashFlow: 15800,
                    revenue: 28500,
                    expenses: 19700,
                    profit: 8800
                }
            },
            'importaciones-gz': {
                name: 'Importaciones GZ',
                icon: 'üì¶',
                status: 'Operativo',
                theme: { primary: '#8b5cf6', secondary: '#a78bfa' },
                data: {
                    cashFlow: 45200,
                    revenue: 72800,
                    expenses: 48600,
                    profit: 24200
                }
            }
        };
    }

    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${type === 'success' ? '#10b981' : '#3b82f6'};
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 10000;
            font-weight: 600;
        `;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => notification.remove(), 3000);
    }

    // ======= INICIALIZACI√ìN =======

    // INICIALIZAR AL CARGAR P√ÅGINA
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ Inicializando IA GRIZALUM');
        
        // Configurar reconocimiento de voz
        initializeVoiceRecognition();
        
        // Cargar paleta guardada
        const savedPalette = localStorage.getItem('grizalum_current_palette');
        if (savedPalette) {
            try {
                const palette = JSON.parse(savedPalette);
                applyColorPalette(palette);
            } catch (e) {
                console.log('No se pudo cargar paleta guardada');
            }
        }
        
        // Conectar eventos del input
        const aiInput = document.getElementById('aiChatInput');
        if (aiInput) {
            aiInput.addEventListener('keydown', handleAIChatKeypress);
            console.log('‚úÖ Input IA conectado');
        }
        
        // Conectar bot√≥n enviar
        const sendBtn = document.querySelector('.ai-send-btn');
        if (sendBtn) {
            sendBtn.addEventListener('click', sendAIMessage);
            console.log('‚úÖ Bot√≥n enviar conectado');
        }
        
        // Conectar bot√≥n de voz
        const voiceBtn = document.getElementById('voiceInputBtn');
        if (voiceBtn) {
            voiceBtn.addEventListener('click', startVoiceInput);
            console.log('‚úÖ Bot√≥n voz conectado');
        }
        
        console.log('‚úÖ IA GRIZALUM COMPLETAMENTE FUNCIONAL');
    });

    console.log('üéØ IA GRIZALUM LISTA PARA USAR');
    console.log('‚ú® Funciones activas:');
    console.log('  ‚Ä¢ Chat inteligente y conversacional');
    console.log('  ‚Ä¢ Cambio de colores aleatorio con el bot√≥n pincel');
    console.log('  ‚Ä¢ Reconocimiento de voz en espa√±ol');
    console.log('  ‚Ä¢ Respuestas contextuales sobre el negocio');
    console.log('  ‚Ä¢ An√°lisis financiero detallado');
    console.log('üöÄ ¬°Disfruta tu asistente IA!');
    </script>
    // FUNCIONES FALTANTES - AGREGAR AL FINAL DEL SCRIPT
let currentEditingCompany = null;

function saveCompaniesData(companies) {
    localStorage.setItem('grizalum_companies', JSON.stringify(companies));
}

function closeManagementModal() {
    // Funci√≥n placeholder
    console.log('Modal cerrado');
}
    <!-- MODAL PARA EDITAR EMPRESA CON SELECTOR DE COLORES -->
<div id="editCompanyModal" class="management-modal">
    <div class="modal-content enhanced-modal">
        <div class="modal-header">
            <h3>‚úèÔ∏è Editar Empresa</h3>
            <button class="close-modal" onclick="closeEditModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">Nombre de la Empresa</label>
                <input type="text" id="editCompanyName" class="form-input" placeholder="Ej: Fundici√≥n Laguna">
            </div>
            
            <div class="form-group">
                <label class="form-label">Icono</label>
                <div class="icon-selector">
                    <div class="icon-option" data-icon="üî•" onclick="selectIcon('üî•')">üî•</div>
                    <div class="icon-option" data-icon="üêî" onclick="selectIcon('üêî')">üêî</div>
                    <div class="icon-option" data-icon="üè™" onclick="selectIcon('üè™')">üè™</div>
                    <div class="icon-option" data-icon="üì¶" onclick="selectIcon('üì¶')">üì¶</div>
                    <div class="icon-option" data-icon="üè≠" onclick="selectIcon('üè≠')">üè≠</div>
                    <div class="icon-option" data-icon="üöõ" onclick="selectIcon('üöõ')">üöõ</div>
                    <div class="icon-option" data-icon="üíº" onclick="selectIcon('üíº')">üíº</div>
                    <div class="icon-option" data-icon="üè¢" onclick="selectIcon('üè¢')">üè¢</div>
                </div>
                <input type="hidden" id="editCompanyIcon" value="üî•">
            </div>

            <!-- NUEVO SELECTOR DE PALETAS DE COLORES -->
            <div class="form-group">
                <label class="form-label">üé® Paleta de Colores Corporativa</label>
                <p class="form-help">Elige los colores que representen tu empresa</p>
                
                <div class="color-palette-selector">
                    <!-- Paleta Oro Ejecutivo -->
                    <div class="palette-card" data-palette="gold" onclick="selectCompanyPalette('gold')">
                        <div class="palette-preview">
                            <div class="color-circle" style="background: #d4af37;"></div>
                            <div class="color-circle" style="background: #b87333;"></div>
                            <div class="color-circle" style="background: #f4d03f;"></div>
                        </div>
                        <div class="palette-info">
                            <h4>Oro Ejecutivo</h4>
                            <p>Elegancia y prestigio</p>
                        </div>
                        <div class="palette-check">
                            <i class="fas fa-check"></i>
                        </div>
                    </div>

                    <!-- Paleta Verde Prosperidad -->
                    <div class="palette-card" data-palette="green" onclick="selectCompanyPalette('green')">
                        <div class="palette-preview">
                            <div class="color-circle" style="background: #059669;"></div>
                            <div class="color-circle" style="background: #10b981;"></div>
                            <div class="color-circle" style="background: #34d399;"></div>
                        </div>
                        <div class="palette-info">
                            <h4>Verde Prosperidad</h4>
                            <p>Crecimiento y √©xito</p>
                        </div>
                        <div class="palette-check">
                            <i class="fas fa-check"></i>
                        </div>
                    </div>

                    <!-- Paleta Azul Corporativo -->
                    <div class="palette-card" data-palette="blue" onclick="selectCompanyPalette('blue')">
                        <div class="palette-preview">
                            <div class="color-circle" style="background: #1e40af;"></div>
                            <div class="color-circle" style="background: #3b82f6;"></div>
                            <div class="color-circle" style="background: #60a5fa;"></div>
                        </div>
                        <div class="palette-info">
                            <h4>Azul Corporativo</h4>
                            <p>Confianza y solidez</p>
                        </div>
                        <div class="palette-check">
                            <i class="fas fa-check"></i>
                        </div>
                    </div>

                    <!-- Paleta P√∫rpura Premium -->
                    <div class="palette-card" data-palette="purple" onclick="selectCompanyPalette('purple')">
                        <div class="palette-preview">
                            <div class="color-circle" style="background: #7c3aed;"></div>
                            <div class="color-circle" style="background: #8b5cf6;"></div>
                            <div class="color-circle" style="background: #a78bfa;"></div>
                        </div>
                        <div class="palette-info">
                            <h4>P√∫rpura Premium</h4>
                            <p>Innovaci√≥n y lujo</p>
                        </div>
                        <div class="palette-check">
                            <i class="fas fa-check"></i>
                        </div>
                    </div>

                    <!-- Paleta Rojo Din√°mico -->
                    <div class="palette-card" data-palette="red" onclick="selectCompanyPalette('red')">
                        <div class="palette-preview">
                            <div class="color-circle" style="background: #dc2626;"></div>
                            <div class="color-circle" style="background: #ef4444;"></div>
                            <div class="color-circle" style="background: #f87171;"></div>
                        </div>
                        <div class="palette-info">
                            <h4>Rojo Din√°mico</h4>
                            <p>Energ√≠a y pasi√≥n</p>
                        </div>
                        <div class="palette-check">
                            <i class="fas fa-check"></i>
                        </div>
                    </div>

                    <!-- Paleta Naranja Energ√©tico -->
                    <div class="palette-card" data-palette="orange" onclick="selectCompanyPalette('orange')">
                        <div class="palette-preview">
                            <div class="color-circle" style="background: #ea580c;"></div>
                            <div class="color-circle" style="background: #f97316;"></div>
                            <div class="color-circle" style="background: #fb923c;"></div>
                        </div>
                        <div class="palette-info">
                            <h4>Naranja Energ√©tico</h4>
                            <p>Creatividad y vitalidad</p>
                        </div>
                        <div class="palette-check">
                            <i class="fas fa-check"></i>
                        </div>
                    </div>

                    <!-- Paleta Turquesa Moderno -->
                    <div class="palette-card" data-palette="teal" onclick="selectCompanyPalette('teal')">
                        <div class="palette-preview">
                            <div class="color-circle" style="background: #0891b2;"></div>
                            <div class="color-circle" style="background: #06b6d4;"></div>
                            <div class="color-circle" style="background: #22d3ee;"></div>
                        </div>
                        <div class="palette-info">
                            <h4>Turquesa Moderno</h4>
                            <p>Frescura y modernidad</p>
                        </div>
                        <div class="palette-check">
                            <i class="fas fa-check"></i>
                        </div>
                    </div>

                    <!-- Paleta Rosa Elegante -->
                    <div class="palette-card" data-palette="pink" onclick="selectCompanyPalette('pink')">
                        <div class="palette-preview">
                            <div class="color-circle" style="background: #ec4899;"></div>
                            <div class="color-circle" style="background: #f472b6;"></div>
                            <div class="color-circle" style="background: #f9a8d4;"></div>
                        </div>
                        <div class="palette-info">
                            <h4>Rosa Elegante</h4>
                            <p>Estilo y sofisticaci√≥n</p>
                        </div>
                        <div class="palette-check">
                            <i class="fas fa-check"></i>
                        </div>
                    </div>
                </div>

                <!-- Vista previa de la paleta seleccionada -->
                <div class="selected-palette-preview" id="selectedPalettePreview">
                    <h4>Vista Previa</h4>
                    <div class="preview-company-card">
                        <div class="preview-icon" id="previewIcon">üî•</div>
                        <div class="preview-info">
                            <div class="preview-name" id="previewName">Fundici√≥n Laguna</div>
                            <div class="preview-status">üü¢ Operativo</div>
                        </div>
                    </div>
                </div>

                <input type="hidden" id="selectedCompanyPalette" value="gold">
            </div>
            
            <div class="form-group">
                <label class="form-label">Estado</label>
                <select id="editCompanyStatus" class="form-input">
                    <option value="Operativo">üü¢ Operativo</option>
                    <option value="Regular">üü° Regular</option>
                    <option value="Mantenimiento">üîµ Mantenimiento</option>
                    <option value="Cerrado">üî¥ Cerrado</option>
                </select>
            </div>
        </div>
        
        <div class="modal-footer">
            <button class="btn btn-success" onclick="saveCompanyChanges()">
                <i class="fas fa-save"></i>
                Guardar Cambios
            </button>
            <button class="btn btn-neutral" onclick="closeEditModal()">
                Cancelar
            </button>
        </div>
    </div>
</div>

<!-- ESTILOS PARA EL SELECTOR DE PALETAS -->
<style>
.enhanced-modal {
    max-width: 800px;
    max-height: 90vh;
    overflow-y: auto;
}

.form-help {
    font-size: 0.8rem;
    color: var(--gray-600);
    margin: 0.25rem 0 1rem 0;
    line-height: 1.4;
}

.color-palette-selector {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.palette-card {
    background: white;
    border: 2px solid var(--gray-200);
    border-radius: 12px;
    padding: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.palette-card:hover {
    border-color: var(--peru-gold);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.palette-card.selected {
    border-color: var(--peru-gold);
    background: linear-gradient(135deg, rgba(212, 175, 55, 0.05) 0%, rgba(184, 115, 51, 0.05) 100%);
    transform: scale(1.02);
    box-shadow: 0 8px 25px rgba(212, 175, 55, 0.2);
}

.palette-preview {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
    justify-content: center;
}

.color-circle {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: 2px solid white;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    transition: transform 0.3s ease;
}

.palette-card:hover .color-circle {
    transform: scale(1.1);
}

.palette-info {
    text-align: center;
}

.palette-info h4 {
    margin: 0 0 0.25rem 0;
    font-size: 0.9rem;
    font-weight: 700;
    color: var(--gray-800);
}

.palette-info p {
    margin: 0;
    font-size: 0.75rem;
    color: var(--gray-600);
    font-style: italic;
}

.palette-check {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    width: 24px;
    height: 24px;
    background: var(--peru-gold);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 0.8rem;
    opacity: 0;
    transform: scale(0);
    transition: all 0.3s ease;
}

.palette-card.selected .palette-check {
    opacity: 1;
    transform: scale(1);
}

.selected-palette-preview {
    background: var(--gray-50);
    border-radius: 12px;
    padding: 1.5rem;
    margin-top: 1rem;
}

.selected-palette-preview h4 {
    margin: 0 0 1rem 0;
    color: var(--gray-800);
    font-size: 0.9rem;
    font-weight: 700;
}

.preview-company-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    background: white;
    padding: 1rem;
    border-radius: 12px;
    border: 2px solid var(--gray-200);
    transition: all 0.3s ease;
}

.preview-icon {
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, #d4af37 0%, #b87333 100%);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
    transition: all 0.3s ease;
}

.preview-info {
    display: flex;
    flex-direction: column;
}

.preview-name {
    font-size: 1rem;
    font-weight: 700;
    color: var(--gray-800);
    margin-bottom: 0.25rem;
}

.preview-status {
    font-size: 0.8rem;
    color: var(--gray-600);
    font-weight: 500;
}

/* Animaciones */
@keyframes paletteSelect {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1.02); }
}

.palette-card.selected {
    animation: paletteSelect 0.3s ease;
}

/* Responsive */
@media (max-width: 768px) {
    .color-palette-selector {
        grid-template-columns: 1fr;
    }
    
    .enhanced-modal {
        max-width: 95%;
    }
}
</style>

<!-- JAVASCRIPT PARA EL SELECTOR DE PALETAS -->
<script>
// Definir paletas de colores
const companyColorPalettes = {
    gold: {
        name: 'Oro Ejecutivo',
        primary: '#d4af37',
        secondary: '#b87333',
        accent: '#f4d03f'
    },
    green: {
        name: 'Verde Prosperidad',
        primary: '#059669',
        secondary: '#10b981',
        accent: '#34d399'
    },
    blue: {
        name: 'Azul Corporativo',
        primary: '#1e40af',
        secondary: '#3b82f6',
        accent: '#60a5fa'
    },
    purple: {
        name: 'P√∫rpura Premium',
        primary: '#7c3aed',
        secondary: '#8b5cf6',
        accent: '#a78bfa'
    },
    red: {
        name: 'Rojo Din√°mico',
        primary: '#dc2626',
        secondary: '#ef4444',
        accent: '#f87171'
    },
    orange: {
        name: 'Naranja Energ√©tico',
        primary: '#ea580c',
        secondary: '#f97316',
        accent: '#fb923c'
    },
    teal: {
        name: 'Turquesa Moderno',
        primary: '#0891b2',
        secondary: '#06b6d4',
        accent: '#22d3ee'
    },
    pink: {
        name: 'Rosa Elegante',
        primary: '#ec4899',
        secondary: '#f472b6',
        accent: '#f9a8d4'
    }
};

// Seleccionar paleta de empresa
function selectCompanyPalette(paletteId) {
    console.log(`üé® Seleccionando paleta: ${paletteId}`);
    
    // Actualizar clases activas
    document.querySelectorAll('.palette-card').forEach(card => {
        card.classList.remove('selected');
    });
    document.querySelector(`[data-palette="${paletteId}"]`).classList.add('selected');
    
    // Guardar selecci√≥n
    document.getElementById('selectedCompanyPalette').value = paletteId;
    
    // Actualizar vista previa
    updatePalettePreview(paletteId);
    
    // Aplicar colores temporalmente a la vista previa
    applyPreviewColors(paletteId);
}

// Actualizar vista previa
function updatePalettePreview(paletteId) {
    const palette = companyColorPalettes[paletteId];
    const previewIcon = document.getElementById('previewIcon');
    const previewName = document.getElementById('previewName');
    
    // Actualizar icono de vista previa
    const selectedIcon = document.querySelector('.icon-option.selected');
    if (selectedIcon) {
        previewIcon.textContent = selectedIcon.dataset.icon;
    }
    
    // Actualizar nombre de vista previa
    const companyName = document.getElementById('editCompanyName').value;
    if (companyName) {
        previewName.textContent = companyName;
    }
    
    // Aplicar colores de la paleta
    previewIcon.style.background = `linear-gradient(135deg, ${palette.primary} 0%, ${palette.secondary} 100%)`;
    
    console.log(`‚úÖ Vista previa actualizada con paleta: ${palette.name}`);
}

// Aplicar colores de vista previa
function applyPreviewColors(paletteId) {
    const palette = companyColorPalettes[paletteId];
    const previewCard = document.querySelector('.preview-company-card');
    
    // Actualizar borde de la tarjeta de vista previa
    previewCard.style.borderColor = palette.primary;
    previewCard.style.background = `linear-gradient(135deg, ${palette.primary}08 0%, ${palette.secondary}08 100%)`;
}

// Funci√≥n mejorada para seleccionar icono que actualiza la vista previa
function selectIcon(icon) {
    document.querySelectorAll('.icon-option').forEach(option => {
        option.classList.remove('selected');
    });
    
    event.target.classList.add('selected');
    document.getElementById('editCompanyIcon').value = icon;
    
    // Actualizar vista previa
    document.getElementById('previewIcon').textContent = icon;
}

// Actualizar vista previa cuando cambie el nombre
document.addEventListener('DOMContentLoaded', function() {
    const nameInput = document.getElementById('editCompanyName');
    if (nameInput) {
        nameInput.addEventListener('input', function() {
            document.getElementById('previewName').textContent = this.value || 'Nombre de Empresa';
        });
    }
});

// Funci√≥n mejorada para guardar cambios con paleta
function saveCompanyChanges() {
    if (!currentEditingCompany) return;
    
    const newName = document.getElementById('editCompanyName').value.trim();
    const newIcon = document.getElementById('editCompanyIcon').value;
    const newStatus = document.getElementById('editCompanyStatus').value;
    const selectedPalette = document.getElementById('selectedCompanyPalette').value;
    
    if (!newName) {
        alert('‚ùå El nombre de la empresa es obligatorio');
        return;
    }
    
    // Obtener datos de la paleta seleccionada
    const paletteData = companyColorPalettes[selectedPalette];
    
    // Actualizar datos de la empresa
    const companies = getCompaniesData();
    if (companies[currentEditingCompany]) {
        companies[currentEditingCompany].name = newName;
        companies[currentEditingCompany].icon = newIcon;
        companies[currentEditingCompany].status = newStatus;
        companies[currentEditingCompany].theme = {
            primary: paletteData.primary,
            secondary: paletteData.secondary,
            accent: paletteData.accent
        };
        companies[currentEditingCompany].paletteName = paletteData.name;
        
        // Guardar en localStorage
        saveCompaniesData(companies);
        
        // Actualizar interfaz
        updateCompanySelector();
        
        // Si es la empresa actual, actualizar vista
        const currentCompany = getCurrentSelectedCompany();
        if (currentCompany === currentEditingCompany) {
            updateSelectedCompany(currentEditingCompany);
            updateCompanyTheme(companies[currentEditingCompany].theme);
        }
        
        closeEditModal();
        showNotification(`‚úÖ Empresa "${newName}" actualizada con paleta "${paletteData.name}"`, 'success');
    }
}

// Inicializar paleta por defecto al abrir modal
function editCompany(companyId) {
    currentEditingCompany = companyId;
    const companies = getCompaniesData();
    const company = companies[companyId];
    
    if (company) {
        document.getElementById('editCompanyName').value = company.name;
        document.getElementById('editCompanyIcon').value = company.icon;
        document.getElementById('editCompanyStatus').value = company.status;
        
        // Marcar icono seleccionado
        document.querySelectorAll('.icon-option').forEach(option => {
            option.classList.remove('selected');
            if (option.dataset.icon === company.icon) {
                option.classList.add('selected');
            }
        });
        
        // Seleccionar paleta actual de la empresa
        const currentPalette = company.theme ? findPaletteByColors(company.theme) : 'gold';
        selectCompanyPalette(currentPalette);
        
        closeManagementModal();
        document.getElementById('editCompanyModal').style.display = 'block';
        document.getElementById('editCompanyModal').classList.add('show');
    }
}

// Funci√≥n auxiliar para encontrar paleta por colores
function findPaletteByColors(theme) {
    for (const [id, palette] of Object.entries(companyColorPalettes)) {
        if (palette.primary === theme.primary) {
            return id;
        }
    }
    return 'gold'; // default
}

console.log('üé® Selector de paletas corporativas cargado');
</script>

    <!-- JAVASCRIPT PARA FUNCIONALIDAD DEL SELECTOR DE EMPRESAS -->
    <script>
    // FUNCIONES DEL SELECTOR DE EMPRESAS
    function toggleCompanyDropdown() {
        const dropdown = document.getElementById('companyDropdown');
        const arrow = document.getElementById('dropdownArrow');
        
        dropdown.classList.toggle('show');
        arrow.classList.toggle('rotate');
    }

    function selectCompany(companyId) {
        // Actualizar empresa seleccionada
        updateSelectedCompany(companyId);
        
        // Actualizar datos de la empresa
        updateCompanyData(companyId);
        
        // Cerrar dropdown
        toggleCompanyDropdown();
        
        // Mostrar mensaje de cambio
        showNotification(`üè¢ Cambiado a ${getCompanyName(companyId)}`, 'success');
    }

    function updateSelectedCompany(companyId) {
        const companies = getCompaniesData();
        const company = companies[companyId];
        
        if (company) {
            document.getElementById('currentCompanyIcon').textContent = company.icon;
            document.getElementById('currentCompanyName').textContent = company.name;
            document.getElementById('currentCompanyStatus').textContent = `üü¢ ${company.status}`;
            
            // Actualizar clase activa
            document.querySelectorAll('.company-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-company="${companyId}"]`).classList.add('active');
        }
    }

    function updateCompanyData(companyId) {
        const companies = getCompaniesData();
        const company = companies[companyId];
        
        if (company) {
            // Actualizar KPIs del dashboard
            updateKPIs(company.data);
            
            // Actualizar sidebar
            updateSidebar(company.data);
            
            console.log(`üìä Datos actualizados para: ${company.name}`);
        }
    }

    function updateKPIs(data) {
        // Actualizar valores en las tarjetas KPI
        const kpiValues = document.querySelectorAll('.kpi-value-animation');
        if (kpiValues.length >= 4) {
            kpiValues[0].textContent = `S/. ${data.cashFlow.toLocaleString()}`;
            kpiValues[1].textContent = `S/. ${data.revenue.toLocaleString()}`;
            kpiValues[2].textContent = `S/. ${data.expenses.toLocaleString()}`;
            kpiValues[3].textContent = `S/. ${data.profit.toLocaleString()}`;
        }
    }

    function updateSidebar(data) {
        // Actualizar valores en el sidebar
        const elements = {
            'sidebarCashFlow': data.cashFlow,
            'sidebarRevenue': data.revenue,
            'sidebarExpenses': data.expenses,
            'sidebarProfit': data.profit
        };
        
        Object.entries(elements).forEach(([id, value]) => {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = `S/. ${value.toLocaleString()}`;
            }
        });
    }

    function getCompanyName(companyId) {
        const companies = getCompaniesData();
        return companies[companyId]?.name || 'Empresa';
    }

    // Cerrar dropdown al hacer clic fuera
    document.addEventListener('click', function(event) {
        const selector = document.getElementById('companySelector');
        const dropdown = document.getElementById('companyDropdown');
        
        if (selector && !selector.contains(event.target)) {
            dropdown.classList.remove('show');
            document.getElementById('dropdownArrow').classList.remove('rotate');
        }
    });

    console.log('üè¢ Selector de empresas GRIZALUM cargado');
    </script>

    <!-- Scripts adicionales -->
    <script src="src/assets/js/main.js"></script>
    <script src="src/assets/js/charts.js"></script>
    
    <script>
    // REGISTRO DEL SERVICE WORKER Y PWA
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', async function() {
            try {
                const registration = await navigator.serviceWorker.register('/sw.js', {
                    scope: '/'
                });
                console.log('‚úÖ GRIZALUM SW registrado:', registration.scope);
            } catch (error) {
                console.error('‚ùå Error registrando Service Worker:', error);
            }
        });
    }

    console.log('üöÄ GRIZALUM Sistema Completo Cargado');
    </script>
</body>
</html>
